<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Api-Document</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAD1BMVEVHcEwzZ9YzZtUzZtYzZ9aXuimUAAAABHRSTlMA40hLwZlVdgAAAD1JREFUKM9jYBi0wNDFRYjBBUq4AAVEXFwcQWxHmIALCIEJBhYHBmoJgMwG24ImIISuhYEcATSnwwUGKQAAN0oX04RzeZMAAAAASUVORK5CYII=">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/jQuery-Validation-Engine/2.6.4/validationEngine.jquery.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/firacode/6.2.0/fira_code.min.css">
    <style>
        * {
            font-family: "Fira Code", "PingFang SC", "Hiragino Sans GB", "Heiti SC", "WenQuanYi Micro Hei", "Microsoft YaHei", monospace, "sans-serif", "Helvetica Neue", Helvetica, Arial, "Glyphicons Halflings" !important;
        }
        html {
            position: relative;
            min-height: 100%;
        }
        header {
            top: 0;
            position: sticky;
            height: 50px;
            width: 100%;
            z-index: 999;
            transition: all .3s ease-in-out;
            border-bottom: 1px solid #f7f8f8;
            display: flex;
        }
        header.scrolled {
            box-shadow: 0 0 10px -2px #333;
            background: rgba(255,255,255,0.94);
        }
        button, input[type=button] {
            outline: none !important;
        }
        .anchor {
            display: block;
            position: relative;
            top: -51px;
            visibility: hidden;
            width: 0;
            height: 0;
        }
        input, select {
            min-width: 180px;
            width: 100%;
            min-height: 28px;
        }
        textarea {
            min-height: 120px;
            height: 100% !important;
            min-width: 180px;
            width: 100% !important;
        }
        input[type=button] {
            width: 180px;
            height: 32px;
            border: none;
            font-size: 16px;
            color: #fff;
            outline: 0 solid transparent;
            background-color: #56baed;
            box-shadow: 0 10px 30px 0 rgba(95,186,233,0.4);
            transition: all 0.3s ease-in-out;
        }
        input[type=button]:hover {
            color: #fff;
            background-color: #39ace7;
        }
        input[type=button]:active {
            transform: scale(0.95);
        }
        .source-code {
            overflow: auto;
            max-height: 386px;
            display: flex;
            align-items: flex-start;
        }
        .line-number {
            color: #2B91AF;
            text-align: right;
            margin-right: 7px;
            border-right: 1px solid;
            min-height: 100%;
            padding: 0 10px;
            display: flex;
            flex-direction: column;
            background: #f5f5f5;
        }
        .source {
            white-space: pre;
        }
        .comment {
            color: #aaa;
            font-style: italic;
        }
        table thead {
            background: rgba(51,51,51,.1);
        }
        table thead tr th {
            white-space: nowrap;
        }
        .header {
            display: flex;
            width: 100%;
        }
        .header-content {
            display: flex;
            align-items: center;
            flex-grow: 1;
            font-size: 26px;
            color: #6495ed;
            overflow: hidden;
            white-space: nowrap;
        }
        .header-select, .header-text {
            display: flex;
            align-items: center;
            flex-grow: 0;
        }
        .header-text {
            white-space: nowrap;
            padding: 0 5px 0 20px;
        }
        .project-choose {
            min-width: 200px;
        }
        .footer {
            background: #f5f5f5;
            padding: 10px 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .footer > div {
            padding: 0 20px;
        }
        .footer > div:not(:last-of-type) {
            border-right: 1px solid #ccc;
        }
        .config {
            margin-top: 10px;
        }

        .panel {
            overflow: auto;
        }
        .input-group {
            position: unset;
        }
        .tab {
            width: 90px;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #ddd;
            margin-right: 10px;
            border: 1px solid transparent;
            border-radius: 4px 4px 0 0;
            position: relative;
            padding: 10px 15px;
            color: #337ab7;
            cursor: pointer;
        }
        .active > .tab {
            background: #bbb;
        }
        .active> .tab, .active > .tab:focus, .active > .tab:hover {
            color: #555;
            cursor: default;
            background: #fff;
            border: 1px solid #ddd;
            border-bottom-color: transparent;
        }
        .tab-content {}
        .module, .module-last {}
        .module-name {
            border-bottom: 5px solid #eee;
            margin-bottom: -5px;
        }
        .module-api {
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        .module-last > .module-api:last-child {
            border-bottom: none;
        }
        .module-api-index {}
        .module-api-info {}
        .module-api-info-basic {
            margin: 7px 0;
        }
        .module-api-info-desc {
            background: #f5f5f5;
            border: 1px solid #ddd;
            margin-bottom: 7px;
            padding: 7px;
            border-radius: 4px;
        }
        .module-api-info-param {}
        .module-api-info-request {}
        .module-api-info-return {}
        .source-info {
            border: 1px solid #ccc;
            border-radius: 4px;
            background: #f5f5f5;
            cursor: text;
        }
        .modal-dialog > .source-info {
            margin: 10px;
            padding: 0;
        }
        .bottom-table {
            margin-bottom: 10px;
        }
        .src-prev {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #ddd;
            background: #f5f5f5;
            padding: 7px;
        }
        .modal-body > .src-prev {
            position: unset;
        }
        .src-prev-left {
            display: flex;
        }
        .src-prev-req-format {
            margin-left: 10px;
            cursor: pointer;
            color: #428bca;
        }
        .src-prev-req-compress {
            margin-left: 10px;
            cursor: pointer;
            color: #449d44;
        }
        .src-prev-req-msg {
            margin-left: 10px;
        }
        .src-prev-res-msg {
            margin-left: 10px;
            font-size: .9em;
        }
        .src-prev-right {
            display: flex;
        }
        .request-data {
            background: #fff;
            max-height: 380px;
            height: 380px;
        }
        .result-data {
            max-height: 380px;
            height: 380px;
        }
        .request-data-info {
            width: 100%;
            height: 100%;
        }
        .result-data-info {
            background: #f5f5f5;
            width: 100%;
            height: 100%;
        }
        .text-left {
            vertical-align: middle !important;
        }
        .config .config-prefix, .response-example {
            color: #337ab7;
            text-decoration: none;
            background-color: transparent;
            cursor: pointer;
        }
        .config .config-prefix:hover, .response-example:hover {
            color: #23527c;
            text-decoration: underline;
        }
        #config-prefix-url .modal-dialog {
            top: 85px;
        }
        .modal-dialog {
            width: 75%;
        }
        .formError {
            white-space: nowrap;
        }
        .example {
            min-width: 200px;
        }
        .curl, .response {
            display: none;
        }
        .bold {
            font-weight: bold !important;
        }
        .wrap {
            white-space: pre-wrap;
        }
        .green {
            color: green !important;
        }
        .red {
            color: red !important;
        }
        .copy-status, .copy, .no-scroll {
            margin: 0 7px;
        }
        .copy, .no-scroll {
            margin-left: 10px;
            cursor: pointer;
        }
        .src-prev-req-format:hover, .src-prev-req-compress:hover, .copy:hover, .no-scroll:hover {
            font-weight: bold;
        }
        .copy-impl {
            opacity: 0;
            width: 0 !important;
            height: 0 !important;
        }
        .col-md-3, .col-md-9 {
            transition: width .5s ease;
        }
        .right-arrow {
            position: fixed;
            top: calc(50px + 1px + 15px);
            right: 0;
            border-radius: 26px 0 0 26px;
            box-shadow: -1px 0 6px rgba(0,0,0,.2);
            width: 26px;
            height: 26px;
            cursor: pointer;
            background: #fff;
            z-index: 20;
        }
        .right-arrow .img {
            width: 26px;
            height: 26px;
            transition: transform .5s ease;
        }

        .bs-docs-sidebar {
            width: inherit;
            position: fixed;
            margin: 15px 0;
        }
        .bs-docs-sidebar > .nav {
            overflow-y: auto;
            max-height: calc(100vh - 51px - 15px - 15px); /* 100vh - header - top - bottom */
        }
        .bs-docs-sidebar .nav > li > a {
            display: block;
            padding: 4px 0 4px 20px;
            font-size: 14px;
            font-weight: 500;
            color: #999;
        }
        .bs-docs-sidebar .nav > li > a:hover,
        .bs-docs-sidebar .nav > li > a:focus {
            padding-left: 19px;
            color: #A1283B;
            text-decoration: none;
            background-color: transparent;
            border-left: 1px solid #A1283B;
        }
        .bs-docs-sidebar .nav > .active > a,
        .bs-docs-sidebar .nav > .active:hover > a,
        .bs-docs-sidebar .nav > .active:focus > a {
            padding-left: 18px;
            font-weight: bold;
            color: #A1283B;
            background-color: transparent;
            border-left: 2px solid #A1283B;
        }
        .bs-docs-sidebar .nav .nav {
            display: none;
            padding-bottom: 10px;
        }
        .bs-docs-sidebar .nav .nav > li > a {
            padding-top: 1px;
            padding-bottom: 1px;
            padding-left: 30px;
            font-size: 12px;
            font-weight: normal;
        }
        .bs-docs-sidebar .nav .nav > li > a:hover,
        .bs-docs-sidebar .nav .nav > li > a:focus {
            padding-left: 29px;
        }
        .bs-docs-sidebar .nav .nav > .active > a,
        .bs-docs-sidebar .nav .nav > .active:hover > a,
        .bs-docs-sidebar .nav .nav > .active:focus > a {
            padding-left: 28px;
            font-weight: 500;
        }
        .bs-docs-sidebar .nav .nav .nav {
            padding-bottom: 10px;
        }
        .bs-docs-sidebar .nav .nav .nav > li > a {
            padding-top: 1px;
            padding-bottom: 1px;
            padding-left: 40px;
            font-size: 12px;
            font-weight: normal;
        }
        .bs-docs-sidebar .nav .nav .nav > li > a:hover,
        .bs-docs-sidebar .nav .nav .nav > li > a:focus {
            padding-left: 39px;
        }
        .bs-docs-sidebar .nav > .active > ul {
            display: block;
        }
        .bs-docs-sidebar .nav .nav .nav > .active > a,
        .bs-docs-sidebar .nav .nav .nav > .active:hover > a,
        .bs-docs-sidebar .nav .nav .nav > .active:focus > a {
            padding-left: 38px;
            font-weight: 500;
        }
        @media print {
            header {
                position: unset;
            }
            .print-nil {
                display: none;
            }
            .text-left, .panel {
                overflow: unset;
            }
            .text-left {
                white-space: pre-wrap;
            }
            .source-code {
                max-height: none;
            }
            .line-number {
                position: unset;
            }
            .src-prev {
                position: unset;
            }
        }
        @media (max-width: 992px), print {
            .col-md-9 {
                width: 100%;
            }
            .right-arrow, .col-md-3 {
                display: none;
            }
        }
        @media (max-width: 992px) {
            .modal-dialog {
                width: 95%;
            }
        }
        @media (min-width: 993px) and (max-width: 1200px) {
            .bs-docs-sidebar {
                padding-left: 10px;
                width: calc(25% - 10px - 10px);
            }
        }
        @media (min-width: 1201px) {
            .bs-docs-sidebar {
                padding-left: 20px;
                width: calc(25% - 20px - 10px);
            }
        }
    </style>
</head>
<body>
<div id="config-prefix-url" class="modal fade" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Config request prefix(When use context-path), or add "?context-path=xxx" to the request url</h4>
        </div>
        <div class="modal-body">
            <input id="prefix-url" class="form-control" placeholder="for example: http://www.example.com/xxx"/>
        </div>
        <div class="modal-footer">
            <button type="button" class="config-btn btn btn-info">Submit</button>
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
    </div>
</div>
<header class="print-nil"><div class="header container"><div class="header-content"></div></div></header>
<script id="choose-project" type="text/x-dot-template">
    <div class="header-text">Choose project:</div>
    <div class="header-select">
        <label><select class="project-choose form-control" name="p">
            <option value="">Current</option>
            {{ let cp = it.project; }}
            {{~ it.projects  :p}}
            {{ let s = (cp.toLowerCase() === p[0].toLowerCase() || cp === p[1]) ? ' selected' : ''; }}
            <option value="{{= p[0]}}" data-url="{{= p[2]}}"{{= s}}>{{= p[1]}}</option>
            {{~}}
        </select></label>
    </div>
</script>
<main class="container-fluid">
    <div class="row">
        <div id="url-info" class="col-md-9"></div>
        <script id="url-render" type="text/x-dot-template">
            {{~ it.moduleList  :module:index}}
            <div class="{{= index + 1 === it.moduleList.length ? 'module-last' : 'module'}}">
                <span id="{{= module.name}}" class="anchor"></span>
                <h2 class="module-name">
                    <span>{{= index + 1}}</span> {{= module.info || ''}}
                </h2>
                {{~ module.urlList  :url:urlIndex}}
                <div class="module-api">
                    {{ let moduleUrlId = module.name + '-' + url.id; }}
                    <span id="{{= moduleUrlId}}" class="anchor"></span>
                    <h3 class="module-api-index">
                        <span>{{= index + 1}}.{{= urlIndex + 1}}</span> {{= url.title || ''}}
                    </h3>
                    <div class="module-api-info">
                        <div><code>{{= url.method || ''}} {{= url.url || ''}}</code></div>
                        <div class="module-api-info-basic"><code>Content-Type : {{= url.contentType || ''}}</code></div>
                        {{
                        let moduleDesc = '';
                        let hasDev = url.develop && url.develop !== '';
                        if (hasDev) {
                            moduleDesc += 'Develop: ' + url.develop;
                        }
                        if (url.desc && url.desc !== '') {
                            if (hasDev) { moduleDesc += '<br>'; }
                            moduleDesc += 'Comment: ' + url.desc;
                        }

                        let printNil = '';
                        if (url.exampleUrl && url.exampleUrl != '') {
                            let example = '<a target="_blank" href="' + url.exampleUrl + '">Result example url</a>';
                            if (moduleDesc !== '') {
                                moduleDesc += '<span class="print-nil"><br><br>' + example + '</span>';
                            } else {
                                printNil = ' print-nil';
                                moduleDesc += example;
                            }
                        }
                        }}
                        <div class="module-api-info-desc bottom-table{{= printNil}}">{{= moduleDesc}}</div>

                        {{
                        let globalParamList = it.tokenList || [];
                        let urlParamList = url.paramList || [];
                        let paramList = String(url.useGlobalParam) === '1' ? globalParamList.concat(urlParamList) : urlParamList;

                        let hasDesc = false, hasFile = false, hasHeader = false, hasExample = false;
                        for (let i = 0; i < paramList.length; i++) {
                        let paramDesc = paramList[i].desc;
                        if (paramDesc !== undefined && paramDesc !== null && paramDesc !== '') { hasDesc = true; }

                        if (String(paramList[i].hasFile) === '1') { hasFile = true; }
                        if (String(paramList[i].paramType) === '1') { hasHeader = true; }

                        let urlExample = paramList[i].example;
                        if (urlExample !== undefined && urlExample !== null && urlExample !== '') { hasExample = true; }
                        }
                        let textNum = 0;

                        let requestActive = localStorage.getItem(moduleUrlId) === '1';
                        }}
                        <ul class="nav nav-tabs bottom-table">
                            <li{{? !requestActive}} class="active"{{?}}>
                                <div class="tab">Example</div>
                            </li>
                            <li{{? requestActive}} class="active"{{?}}>
                                <div class="tab" data-tab="1">Request</div>
                            </li>
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane fade{{? !requestActive}} in active{{?}}">
                                {{? paramList && paramList.length > 0}}
                                <div class="module-api-info-param bottom-table panel panel-default">
                                    <table class="table table-striped table-bordered table-hover table-condensed">
                                        <thead>
                                        <tr>
                                            <th class="text-left">Param name</th>
                                            <th class="text-left">Data type</th>
                                            {{? hasExample}}<th class="text-left">Example</th>{{?}}
                                            <th class="text-left">Required</th>
                                            {{? hasHeader}}<th class="text-left">Param type</th>{{?}}
                                            {{? hasDesc}}<th class="text-left">Comment</th>{{?}}
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {{~ paramList  :param}}
                                        <tr{{? String(param.required) === '1'}} class="bold"{{?}}{{? param.style && param.style !== ''}} style="{{= param.style}}"{{?}}>
                                        <td class="text-left">{{= param.name || ''}}</td>
                                        <td class="text-left">{{=
                                            param.showDataType !== undefined && param.showDataType !== null && param.showDataType !== ''
                                            ? param.showDataType
                                            : (param.dataType !== undefined && param.dataType !== null && param.dataType !== '' ? param.dataType : '')
                                        }}</td>
                                        {{? hasExample}}<td class="text-left wrap">{{= param.example || ''}}</td>{{?}}
                                        <td class="text-left">{{= String(param.required) === '1' ? '✓' : '✗'}}</td>
                                        {{? hasHeader}}<td class="text-left">{{= String(param.paramType) === '1' ? 'Header' : 'Query'}}</td>{{?}}
                                        {{? hasDesc}}<td class="text-left wrap">{{= param.desc || ''}}</td>{{?}}
                                        </tr>
                                        {{~}}
                                        </tbody>
                                    </table>
                                </div>
                                {{?}}

                                {{? url.requestBodyJson !== undefined && url.requestBodyJson !== null && url.requestBodyJson !== ''}}
                                <div class="module-api-info-request source-info bottom-table">
                                    <div class="src-prev">
                                        <div class="src-prev-left">Request example</div>
                                        <div class="src-prev-right">
                                            <div class="copy-status green print-nil"></div>
                                            <div class="copy print-nil">Copy(uncomment)</div>
                                            <div class="no-scroll print-nil">No-Scroll</div>
                                        </div>
                                    </div>
                                    <div class="source-code" data-flag="module-api-info-request-src">{{= url.requestBodyJson || ''}}</div>
                                </div>
                                {{?}}

                                <div class="module-api-info-return source-info bottom-table">
                                    <div class="src-prev">
                                        <div class="src-prev-left">Response example</div>
                                        <div class="src-prev-right">
                                            <div class="copy-status green print-nil"></div>
                                            <div class="copy print-nil">Copy(uncomment)</div>
                                            <div class="no-scroll print-nil">No-Scroll</div>
                                        </div>
                                    </div>
                                    <div class="source-code" data-flag="module-api-info-response-src">{{= url.commentJson || ''}}</div>
                                </div>

                                {{? url.returnList && url.returnList.length > 0}}
                                <div class="bottom-table panel panel-default" data-flag="module-api-info-response-comment">
                                    <table class="table table-striped table-bordered table-hover table-condensed">
                                        <thead>
                                        <tr>
                                            <th class="text-left">Return field name</th>
                                            <th class="text-left">Type</th>
                                            <th class="text-left">Comment</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {{~ url.returnList  :rtn}}
                                        <tr>
                                            <td class="text-left">{{= rtn.name || ''}}</td>
                                            <td class="text-left">{{= rtn.type || ''}}</td>
                                            <td class="text-left wrap">
                                                {{= (rtn.desc || '').replace(/(!!!RECURSIVE OBJECT!!!)/, '<span class="bold red">$1</span>')}}
                                            </td>
                                        </tr>
                                        {{~}}
                                        </tbody>
                                    </table>
                                </div>
                                {{?}}

                                {{
                                let hasSelfResponse = false;
                                let responseList;
                                if (url.responseList && url.responseList.length > 0) {
                                hasSelfResponse = true;
                                responseList = url.responseList;
                                } else if (it.responseList && it.responseList.length > 0) {
                                responseList = it.responseList;
                                } else {
                                responseList = [];
                                }

                                let hasAction = false;
                                for (let i = 0; i < responseList.length; i++) {
                                let comment = responseList[i].comment;
                                if (comment !== undefined && comment !== null && comment !== '') {
                                hasAction = true;
                                }
                                }
                                }}
                                {{? responseList.length > 0}}
                                <div class="bottom-table panel panel-default">
                                    <table class="table table-striped table-bordered table-hover table-condensed">
                                        <thead>
                                        <tr>
                                            <th class="text-left">Response Code</th>
                                            <th class="text-left">Comment</th>
                                            {{? hasAction}}<th class="text-left print-nil">Action</th>{{?}}
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {{~ responseList  :response}}
                                        <tr>
                                            <td class="text-left">{{= response.code || ''}}</td>
                                            <td class="text-left">{{= response.msg || ''}}</td>
                                            {{
                                            let comment = response.comment;
                                            let targetId = hasSelfResponse ? (module.name + '-' + url.id + '-' + response.code) : ('global-' + response.code);
                                            }}
                                            {{? comment !== undefined && comment !== null && comment !== ''}}
                                            <td class="text-left print-nil">
                                                <span class="response-example" title="click to view response {{= response.code + ': ' + response.msg}}"
                                                      data-toggle="modal" data-target="#{{= targetId}}">View example</span>
                                            </td>
                                            {{?? hasAction}}
                                            <td class="text-left print-nil"></td>
                                            {{?}}
                                        </tr>
                                        {{~}}
                                        </tbody>
                                    </table>
                                </div>

                                {{? hasSelfResponse}}
                                {{~ responseList  :response}}
                                {{ let comment = response.comment; }}
                                {{? comment !== undefined && comment !== null && comment !== ''}}
                                <div id="{{= module.name}}-{{= url.id}}-{{= response.code}}" class="modal fade"
                                     tabindex="-1"  aria-hidden="true" data-backdrop="static" data-keyboard="false">
                                    <div class="modal-dialog modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                                            <h4 class="modal-title">
                                                Module「{{= module.info || ''}}」api「{{= url.title || ''}}」response「{{= response.code + ': ' + response.msg}}」
                                            </h4>
                                        </div>
                                        <div class="modal-body">
                                            <div class="source-info">
                                                <div class="src-prev">
                                                    <div class="src-prev-left"></div>
                                                    <div class="src-prev-right">
                                                        <div class="copy-status green print-nil"></div>
                                                        <div class="copy print-nil">Copy(uncomment)</div>
                                                        <div class="no-scroll print-nil">No-Scroll</div>
                                                    </div>
                                                </div>
                                                <div class="source-code">{{= response.comment || ''}}</div>
                                            </div>

                                            {{? response.returnList && response.returnList.length > 0}}
                                            <div class="bottom-table panel panel-default">
                                                <table class="table table-striped table-bordered table-hover table-condensed">
                                                    <thead>
                                                    <tr>
                                                        <th class="text-left">Name</th>
                                                        <th class="text-left">Type</th>
                                                        <th class="text-left">Comment</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    {{~ response.returnList  :rtn}}
                                                    <tr>
                                                        <td class="text-left">{{= rtn.name || ''}}</td>
                                                        <td class="text-left">{{= rtn.type || ''}}</td>
                                                        <td class="text-left wrap">
                                                            {{= (rtn.desc || '').replace(/(!!!RECURSIVE OBJECT!!!)/, '<span class="bold red">$1</span>')}}
                                                        </td>
                                                    </tr>
                                                    {{~}}
                                                    </tbody>
                                                </table>
                                            </div>
                                            {{?}}
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                        </div>
                                    </div>
                                </div>
                                {{?}}
                                {{~}}
                                {{?}}
                                {{?}}
                            </div>

                            <div class="tab-pane fade{{? requestActive}} in active{{?}}">
                                <form class="module-api-info-param"{{? url.method}} method="{{= url.method}}"{{?}}
                                      {{? String(url.requestBody) === '1'}} request-body="1"{{?}}
                                      {{? String(url.basicParamRequestBody) === '1'}} basic-param-request-body="1"{{?}}
                                      action="{{= url.url}}"{{? hasFile}} enctype="multipart/form-data"{{?}}>
                                    {{? paramList && paramList.length > 0}}
                                    <div class="bottom-table panel panel-default">
                                        <table class="table table-striped table-bordered table-hover table-condensed">
                                            <thead>
                                            <tr>
                                                <th class="text-left">Param name</th>
                                                <th class="text-left example">Param Value</th>
                                                <th class="text-left">Required</th>
                                                <th class="text-left">Data type</th>
                                                {{? hasHeader}}<th class="text-left">Param type</th>{{?}}
                                                {{? hasDesc}}<th class="text-left">Comment</th>{{?}}
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {{~ paramList  :param:paramIndex}}
                                            {{
                                            let hasTextarea = String(param.hasTextarea) === '1';
                                            let arr = [];
                                            let required;
                                            if (String(param.required) === '1') { required = true; arr.push('required'); }
                                            else { required = false; }

                                            let dataType = (param.dataType || '').toLowerCase();
                                            if (dataType === 'int' || dataType === 'long') { arr.push('custom[integer]'); }
                                            else if (dataType === 'float' || dataType === 'double') { arr.push('custom[number]'); }
                                            else if (dataType === 'email') { arr.push('custom[email]'); }
                                            else if (dataType === 'url') { arr.push('custom[url]'); }
                                            else if (dataType === 'ipv4') { arr.push('custom[ipv4]'); }

                                            let arrJoin = arr.filter(function(e){ return e !== undefined && e !== null && e !== ''; }).join(',');

                                            let validateClass = (arrJoin !== undefined && arrJoin !== null && arrJoin !== '') ? (' validate[' + arrJoin + ']') : '';
                                            let tokenClass = String(param.hasToken) === '1' ? ' has-token' : ' data-info';
                                            let header = String(param.paramType) === '1' ? ' header="1"' : '';
                                            let dataKey = (moduleUrlId + ':' + param.name);
                                            let example = localStorage.getItem('$global-header-' + param.name) || localStorage.getItem(dataKey) || param.example || '';

                                            let enumRegexExec = /^enum\((.*?)\)$/.exec(param.dataType);
                                            let enumInfo = (Array.isArray(enumRegexExec) && enumRegexExec.length > 1) ? it.enumInfo[enumRegexExec[1]] : '';
                                            }}
                                            <tr{{? required}} class="bold"{{?}}{{? param.style && param.style !== ''}} style="{{= param.style}}"{{?}}>
                                                <td class="text-left">{{= param.name || ''}}</td>
                                                <td class="text-left" style="height: inherit;">
                                                    {{? dataType === 'file'}}
                                                    <div class="input-group">
                                                        <label class="input-group-btn">
                                                            <span class="btn btn-default{{? required}} bold{{?}}">
                                                                Browse...
                                                                <input class="form-file hidden" type="file" name="{{= param.name || ''}}">
                                                            </span>
                                                        </label>
                                                        <input type="text"{{? param.desc}} placeholder="{{= param.desc}}{{? param.example}}: {{= param.example}}{{?}}"{{?}}
                                                               class="form-control{{? required}} bold{{?}}{{= validateClass}}" readonly="readonly">
                                                    </div>
                                                    {{?? hasTextarea}}
                                                    <textarea {{? param.desc}}placeholder="{{= param.desc}}{{? param.example}}: {{= param.example}}{{?}}" {{?}}class="form-control{{= validateClass}}{{= tokenClass}}" style="border:1px solid #ccc;border-radius:4px;" name="{{= param.name || ''}}"{{= header}}>{{= example}}</textarea>
                                                    {{?? enumInfo !== undefined && enumInfo !== null && enumInfo !== ''}}
                                                    <select class="form-control{{= validateClass}}{{= tokenClass}}" name="{{= param.name || ''}}"{{= header}}>
                                                        <option></option>
                                                        {{? Array.isArray(enumInfo) }}
                                                        {{~ enumInfo  :e}}<option{{? example === e}} selected="selected"{{?}}>{{= e}}</option>{{~}}
                                                        {{??}}
                                                        {{ let k; for(k in enumInfo) { }}
                                                        <option value="{{= k}}"{{? example === k || example === enumInfo[k]}} selected="selected"{{?}}>{{= enumInfo[k]}}</option>
                                                        {{ } }}
                                                        {{?}}
                                                    </select>
                                                    {{?? (param.showDataType || '').toLowerCase() === 'date' || dataType === 'date'}}
                                                    {{ let hasFormat = param.datePattern !== undefined && param.datePattern !== null && param.datePattern !== '';}}
                                                    <div class="input-group date form-datetime">
                                                        <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
                                                        <input type="text" name="{{= param.name || ''}}"{{= header}}
                                                               {{? param.desc}} placeholder="{{= param.desc}}{{? param.example}}: {{= param.example}}{{?}}"{{?}}
                                                               class="form-control{{? required}} bold{{?}}{{= validateClass}}{{= tokenClass}}" value="{{= example}}"
                                                               {{? hasFormat}} data-date-format="{{= param.datePattern.replace(/yy/g, 'YY').replace(/dd/, 'DD')}}"{{?}}/>
                                                    </div>
                                                    {{??}}
                                                    {{ textNum++; }}
                                                    <input {{? param.desc}} placeholder="{{= param.desc}}{{? param.example}}: {{= param.example}}{{?}}"{{?}}
                                                           class="form-control{{= validateClass}}{{= tokenClass}}"
                                                           type="{{= dataType === 'password' || (param.name || '').toLowerCase() === 'password' ? 'password' : 'text'}}"
                                                           name="{{= param.name || ''}}"{{= header}} value="{{= example}}"/>
                                                    {{?}}
                                                </td>
                                                <td class="text-left">{{= required ? '✓' : '✗'}}</td>
                                                <td class="text-left">{{=
                                                    param.showDataType && param.showDataType !== ''
                                                        ? param.showDataType
                                                        : (param.dataType && param.dataType !== '' ? param.dataType : '')
                                                }}</td>
                                                {{? hasHeader}}<td class="text-left">{{= String(param.paramType) === '1' ? 'Header' : 'Query'}}</td>{{?}}
                                                {{? hasDesc}}<td class="text-left wrap">{{= param.desc || ''}}</td>{{?}}
                                            </tr>
                                            {{~}}
                                            </tbody>
                                        </table>
                                    </div>
                                    {{?}}

                                    {{? url.requestBodyJson !== undefined && url.requestBodyJson !== null && url.requestBodyJson !== ''}}
                                    <div class="bottom-table source-info">
                                        <div class="src-prev">
                                            <div class="src-prev-left">
                                                <span>Request-Body</span>
                                                <span class="src-prev-req-format print-nil">Format-Json</span>
                                                <span class="src-prev-req-compress print-nil">Compress</span>
                                                <span class="src-prev-req-msg red print-nil"></span>
                                            </div>
                                            <div class="src-prev-right">
                                                <div class="copy-status green print-nil"></div>
                                                <div class="copy print-nil">Copy(uncomment)</div>
                                                <div class="no-scroll print-nil">No-Scroll</div>
                                            </div>
                                        </div>
                                        {{
                                        let requestBodyKey = '_request_body_';
                                        let requestBodyData = localStorage.getItem(moduleUrlId + ':' + requestBodyKey + '') || '';
                                        }}
                                        <div class="request-data">
                                            <div class="request-data-info" data-lpignore="true" data-name="{{= requestBodyKey}}">{{= requestBodyData}}</div>
                                        </div>
                                    </div>
                                    {{?}}

                                    <div class="bottom-table">
                                        /* When there is only one input text on the form, adding an invisible input can disable the carriage return event for that input. */
                                        {{? textNum === 1 }}<input type="text" class="hidden" />{{?}}
                                        <input class="form-submit btn" type="button" value="Request backend"/>
                                    </div>

                                    <div class="curl bottom-table source-info">
                                        <div class="src-prev">
                                            <div class="src-prev-left">cURL</div>
                                            <div class="src-prev-right">
                                                <div class="copy-status green print-nil"></div>
                                                <div class="copy print-nil">Copy</div>
                                            </div>
                                        </div>
                                        <div class="source-code"></div>
                                    </div>

                                    <div class="response bottom-table source-info">
                                        <div class="src-prev">
                                            <div class="src-prev-left">
                                                <span>Response</span><span class="src-prev-res-msg green print-nil"></span>
                                            </div>
                                            <div class="src-prev-right">
                                                <div class="copy-status green print-nil"></div>
                                                <div class="copy print-nil">Copy(uncomment)</div>
                                                <div class="no-scroll print-nil">No-Scroll</div>
                                            </div>
                                        </div>
                                        <div class="result-data">
                                            <div class="result-data-info" data-lpignore="true"></div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                {{~}}
            </div>
            {{~}}

            {{~ it.responseList  :response}}
            {{ let comment = response.comment; }}
            {{? comment !== undefined && comment !== null && comment !== ''}}
            <div id="global-{{= response.code}}" class="modal fade" tabindex="-1"
                 aria-hidden="true" data-backdrop="static" data-keyboard="false">
                <div class="modal-dialog modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">
                            View example of global response「{{= response.code + ': ' + response.msg}}」
                        </h4>
                    </div>
                    <div class="modal-body">
                        <div class="source-info">
                            <div class="src-prev">
                                <div class="src-prev-left"></div>
                                <div class="src-prev-right">
                                    <div class="copy-status green print-nil"></div>
                                    <div class="copy print-nil">Copy(uncomment)</div>
                                    <div class="no-scroll print-nil">No-Scroll</div>
                                </div>
                            </div>
                            <div class="source-code">{{= response.comment || ''}}</div>
                        </div>

                        {{? response.returnList && response.returnList.length > 0}}
                        <div class="bottom-table panel panel-default">
                            <table class="table table-striped table-bordered table-hover table-condensed">
                                <thead>
                                <tr>
                                    <th class="text-left">field name</th>
                                    <th class="text-left">type</th>
                                    <th class="text-left">comment</th>
                                </tr>
                                </thead>
                                <tbody>
                                {{~ response.returnList  :rtn}}
                                <tr>
                                    <td class="text-left">{{= rtn.name || ''}}</td>
                                    <td class="text-left">{{= rtn.type || ''}}</td>
                                    <td class="text-left wrap">{{= (rtn.desc || '').replace(/(!!!RECURSIVE OBJECT!!!)/, '<span class="bold red">$1</span>')}}</td>
                                </tr>
                                {{~}}
                                </tbody>
                            </table>
                        </div>
                        {{?}}
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
            {{?}}
            {{~}}
        </script>
        <div class="right-arrow print-nil">
            <svg viewBox="0 0 24 24" class="img"><path d="M8.59,16.59L13.17,12L8.59,7.41L10,6l6,6l-6,6L8.59,16.59z"/></svg>
        </div>
        <div class="col-md-3">
            <div class="bs-docs-sidebar">
                <ul id="url-nav-info" class="nav"></ul>
                <script id="url-nav-render" type="text/x-dot-template">
                    {{~ it.moduleList  :module:index}}
                    <li>
                        <a href="#{{= module.name}}">{{= index + 1}} {{= module.info || ''}}</a>
                        <ul class="nav">
                            {{~ module.urlList  :url:urlIndex}}
                            <li>
                                <a href="#{{= module.name}}-{{= url.id}}">{{= index + 1}}.{{= urlIndex + 1}} {{= url.title || ''}}</a>
                            </li>
                            {{~}}
                        </ul>
                    </li>
                    {{~}}
                </script>
            </div>
        </div>
    </div>
</main>
<footer></footer>
<script id="copyright" type="text/x-dot-template">
    <div class="footer">
        <div class="version">Version: {{= it.version || ''}}</div>
        <div class="statistics">{{= it.groupCount || ''}} module, {{= it.apiCount || ''}} api</div>
        <div class="team">{{= it.team || ''}}</div>
        <div class="copyright">&copy; {{= new Date().getFullYear()}} {{= it.copyright || ''}}</div>
    </div>
</script>

<!--[if lt IE 9]>
<script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/dot/1.1.2/doT.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jQuery-Validation-Engine/2.6.4/languages/jquery.validationEngine-en.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jQuery-Validation-Engine/2.6.4/jquery.validationEngine.min.js"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-json.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.12.5/ace.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/json5/2.2.1/index.min.js"></script>

<script type="text/javascript">
function isBlank(str) {
    return str === undefined || str === null || str === 'undefined' || str === 'null' || str === '';
}
function isNotBlank(str) {
    return !isBlank(str);
}
function hasEnter(event) {
    if (event.defaultPrevented) {
        return;
    }

    let handled;
    if (event.key !== undefined) {
        handled = event.key.toUpperCase() === 'ENTER';
    } else if (event.keyIdentifier !== undefined) {
        handled = event.keyIdentifier.toUpperCase() === 'ENTER';
    } else if (event.keyCode !== undefined) {
        handled = event.keyCode === 13 || event.keyCode === '13';
    } else {
        handled = false;
    }
    if (handled) {
        event.preventDefault();
    }
    return handled;
}

let localServerPathItem = '__prefix-url__';
function handleContextPath() {
    let param = 'context-path=', append = '&';
    let search = location.search.trim();
    if (search.includes(param)) {
        let path = search.substring(search.indexOf(param) + param.length);
        if (isNotBlank(path)) {
            if (path.includes(append)) {
                path = path.substring(0, path.indexOf(append));
            }
            let uri = path.toLowerCase();
            if (!uri.startsWith('http://') && !uri.startsWith('https://')) {
                path = location.protocol + '//' + location.host + (path.startsWith('/') ? '' : '/') + path;
            }
            localStorage.setItem(localServerPathItem, path);
        } else {
            localStorage.removeItem(localServerPathItem);
        }
    }
}
handleContextPath();

function newRequest() {
    let url = $('#prefix-url').val();
    if (isNotBlank(url)) {
        if (!url.toLowerCase().startsWith('http://') && !url.toLowerCase().startsWith('https://')) {
            url = location.protocol + '//' + url;
        }
        localStorage.setItem(localServerPathItem, url);
    } else {
        localStorage.removeItem(localServerPathItem);
    }
    $('#config-prefix-url').modal('hide');
    loadMulti();
}
function addLine(html) {
    if (isBlank(html)) {
        return '';
    }
    let lineHtml = '<div class="line-number">';
    let i, lineNum = html.split(/\n/).length;
    for (i = 1; i <= lineNum; i++) {
        lineHtml += '<div>' + i + '</div>';
    }
    lineHtml += '</div>';
    return lineHtml + '<div class="source language-json">' + html + '</div>';
}
function escapeHtml(html) {
    return isBlank(html) ? null : html.replace(/</g, '&lt;').replace(/>/g, '&gt;');
}
function getDomain() {
    let url = localStorage.getItem(localServerPathItem);
    return isBlank(url) ? (location.protocol + '//' + location.host) : url;
}
function getProjectDomain() {
    let url = getDomain();
    if (isNotBlank(url)) {
        return url;
    }
    let projectDomain = $('.project-choose').find('option:selected').data('url');
    return isBlank(projectDomain) ? (location.protocol + '//' + location.host) : projectDomain;
}
function timeLog(start) {
    let end = new Date().getTime();
    return '[' + formatDate(start) + ' -> ' + formatDate(end) + ' (' + (end - start) + ' ms)]';
}
function objectifyForm(form) {
    let headers = {};
    let params = {};
    $.each(form.serializeArray(), function(i, field) {
        let name = field.name;
        let value = field.value;

        let header = form.find('[name="' + name + '"]').attr('header');
        if (String(header) === '1') {
            headers[name] = value;
        } else {
            params[name] = value;
        }
    });
    return [params, headers, form.find('input[type="file"]')];
}
function formatDate(date) {
    let d = new Date(date);

    let y = d.getFullYear().toString();
    let m = (d.getMonth() + 1).toString();
    if (m.length === 1) {
        m = '0' + m;
    }
    let dy = d.getDate().toString();
    if (dy.length === 1) {
        dy = '0' + dy;
    }
    let h = d.getHours().toString();
    if (h.length === 1) {
        h = '0' + h;
    }
    let mt = d.getMinutes().toString();
    if (mt.length === 1) {
        mt = '0' + mt;
    }
    let s = d.getSeconds().toString();
    if (s.length === 1) {
        s = '0' + s;
    }
    let S = d.getMilliseconds().toString();
    if (S.length === 1) {
        S = '00' + S;
    } else if (S.length === 2) {
        S = '0' + S;
    }
    return y + '-' + m + '-' + dy + ' ' + h + ':' + mt + ':' + s + '.' + S;
}

let chooseProjectTemplate = doT.template($('#choose-project').html());
let copyrightTemplate = doT.template($('#copyright').html());
let urlRenderTemplate = doT.template($('#url-render').html());
let navRenderTemplate = doT.template($('#url-nav-render').html());

loadMulti();

function loadMulti() {
    $.get(getDomain() + '/api/project').done(function (data) {
        if (isNotBlank(data)) {
            let projectInfo = ((typeof data === 'string') ? JSON.parse(data) : data);
            if (isNotBlank(projectInfo)) {
                let project = location.search;
                let param = 'p=', append = '&';
                if (project.includes(param)) {
                    project = project.substring(project.indexOf(param) + param.length);
                    if (project.includes(append)) {
                        project = project.substring(0, project.indexOf(append));
                    }
                }
                $(".header").append(chooseProjectTemplate({"project": project, "projects": projectInfo}));
            }
        }
        loadData();
    }).fail(function () {
        loadData();
    });
}

let rightArrowKey = '__right-arrow__';
function loadData() {
    let $title = $('title');
    let $headerContent = $('.header-content');
    let $footer = $('footer');
    let $urlInfo = $('#url-info');
    let $urlNavInfo = $('#url-nav-info');
    let $rightArrow = $('.right-arrow');

    $title.html('');
    $headerContent.html('');
    $footer.html('');
    $urlInfo.html('');
    $urlNavInfo.html('');

    let method = 'GET';
    let apiInfo = '/api/info';
    let projectDomain = getProjectDomain();
    let requestUrl = projectDomain.endsWith(apiInfo) ? projectDomain
        : ((projectDomain.endsWith('/') ? projectDomain.substring(0, projectDomain.length - 1) : projectDomain) + apiInfo);

    $.ajax({
        method: method,
        url: requestUrl,
        crossDomain: true
    }).done(function(data) {
        if (isNotBlank(data)) {
            let documentInfo = ((typeof data === 'string') ? JSON.parse(data) : data);
            let copyright = documentInfo.copyright;
            if (isBlank(copyright)) {
                handleError($rightArrow, $urlInfo, 'Return data error!');
                return;
            }

            let title = (isNotBlank(copyright.title) ? (copyright.title + ' - ') : '') + 'Front-Back-end interaction';
            $title.html(title);
            $headerContent.html(title);
            $footer.html(copyrightTemplate(copyright));

            let doc = documentInfo.document;
            if (isBlank(doc)) {
                return;
            }
            $urlInfo.html(urlRenderTemplate(doc));
            $urlNavInfo.html(navRenderTemplate(doc));
            $('.bs-docs-sidebar > .nav').css('max-height', 'calc(100vh - 51px - 15px - 15px)');

            let $nav = $('.col-md-3');
            if (localStorage.getItem(rightArrowKey) === '1') {
                let $content = $('.col-md-9');
                $rightArrow.css('display', 'none');
                $nav.css('display', 'none');
                $content.css('display', 'none');

                $rightArrow.find('.img').css('transform', 'rotate(180deg)');
                $nav.css('width', '0');
                $content.css('width', '100%');

                $rightArrow.css('display', '');
                $nav.css('display', '');
                $content.css('display', '');
            }

            $('.request-data-info').each(function () {
                setEdit($(this));
            });

            $('.source-code').each(function() {
                let html = escapeHtml($(this).html());
                if (isNotBlank(html)) {
                    html = html.replace(/(!!!RECURSIVE OBJECT!!!)/g, '<span class="bold red">$1</span>');
                    $(this).html(addLine(html));
                    Prism.highlightElement($(this).find('.source')[0]);
                } else {
                    $(this).html(addLine('<span class="red">Empty Or Parse Error</span>'));
                }
            });

            if ($nav.css('display') !== 'none') {
                let hash = location.hash;
                if (isNotBlank(hash)) {
                    let $anchor = $(hash);
                    if ($anchor.length > 0) {
                        let $li = $('a[href="' + hash + '"]').parents('li');
                        $li.addClass('active');
                        $li.parents('li').addClass('active');
                        $('html,body').animate({scrollTop: $anchor.offset().top}, 0);
                    }
                }
            }

            $('.form-datetime').datetimepicker({
                ignoreReadonly: true,
                showTodayButton: true,
                showClear: true,
                showClose: true
            }).on('dp.change', function() {
                let $this = $(this).find('.data-info');
                handleItem($this, $this.val());
            });
        } else {
            $urlInfo.html('<span class="red">No api info</span>');
        }
    }).fail(function(error) {
        console.error(method + ' ' + requestUrl + ' error: ' + JSON.stringify(error));
        handleError($rightArrow, $urlInfo, 'Request error, Incorrect network or cross-domain error!');
    });
}
function handleError($arrow, $ele, info) {
    $arrow.css('display', 'none');
    $ele.html('<div class="config red">' + info + '</div>' +
        '<div class="config">context-path error? <span class="config-prefix" data-toggle="modal" data-target="#config-prefix-url">config</span></div>' +
        '<div class="config">config error? <span id="delete-prefix" class="config-prefix">delete</span></div>');
}

function setEdit(ele) {
    let editor = (ace.edit(ele[0]) || ace.edit(ele));
    let session = editor.getSession();
    session.setOptions({ tabSize: 2, useSoftTabs: false });
    session.setUseWrapMode(true);
    session.setUseWorker(false);
    session.setMode("ace/mode/json");
    editor.setTheme("ace/theme/chrome");
    editor.setAutoScrollEditorIntoView(true);
    editor.setShowPrintMargin(false);

    editor.on('change', function() {
        let $this = $(document.activeElement);
        let itemKey = $this.closest('.module-api').find('.anchor').attr('id') + ':' + $this.closest('.request-data-info').attr('data-name');
        let editValue = editor.getValue();
        if (isNotBlank(editValue)) {
            localStorage.setItem(itemKey, editValue);
        } else {
            localStorage.removeItem(itemKey);
        }
    });
}
function getValueHeight(ele) {
    return (ace.edit(ele[0]) || ace.edit(ele)).renderer.layerConfig.maxHeight;
}
function getEditValue(ele) {
    return (ace.edit(ele[0]) || ace.edit(ele)).getValue();
}
function setEditValue(ele, value) {
    (ace.edit(ele[0]) || ace.edit(ele)).getSession().setValue(value, -1);
}
function resizeEdit(ele) {
    (ace.edit(ele[0]) || ace.edit(ele)).resize();
}
function allResize() {
    $('.request-data-info').each(function() {
        resizeEdit($(this));
    });
}

function addComment(json, element, res) {
    let fieldCommentRelation = handleFieldCommentRelation(element, res);
    if (isBlank(fieldCommentRelation)) {
        return json;
    }

    let lineFieldRelation = handleLineFieldRelation(json);
    if (isBlank(lineFieldRelation)) {
        return json;
    }

    let returnJson = '';
    let i, lines = json.split('\n');
    for (i = 0; i < lines.length; i++) {
        returnJson += lines[i];
        let comment = getComment(lineFieldRelation, fieldCommentRelation, i.toString());
        if (isNotBlank(comment)) {
            returnJson += ' '.repeat(2) + '/* ' + comment + ' */';
        }
        returnJson += '\n';
    }
    return returnJson.trim();
}
function handleFieldCommentRelation(element, res) {
    if (res) {
        let relation = relationByComment(element.find('[data-flag="module-api-info-response-comment"]'));
        return isNotBlank(relation) ? relation : relationBySource(element.find('[data-flag="module-api-info-response-src"]'));
    } else {
        return relationBySource(element.find('[data-flag="module-api-info-request-src"]'));
    }
}
function relationByComment(allComment) {
    if (isBlank(allComment.html())) {
        return null;
    }
    let $trs = allComment.find('table > tbody > tr');
    if (hasExampleWithLevel($trs)) {
        return returnCommentWithParentLevel($trs);
    } else {
        return returnCommentWithLevel($trs);
    }
}
function hasExampleWithLevel(trsInTable) {
    let i, len = trsInTable.length;
    for (i = 0; i < len; i++) {
        let tds = $(trsInTable[i]).find('td');
        if (tds.length > 2) {
            let name = $(tds[0]).text();
            if (name.includes(' -> ')) {
                return true;
            }
        }
    }
    return false;
}
function returnCommentWithParentLevel($trs) {
    let paramCommentRelation = {};
    let i, len = $trs.length;
    for (i = 0; i < len; i++) {
        let $tds = $($trs[i]).find('td');
        if ($tds.length > 2) {
            let comment = $($tds[2]).text().trim();
            if (isNotBlank(comment)) {
                let name = $($tds[0]).text().trim();
                paramCommentRelation[name.split(' -> ').reverse().join('.')] = comment;
            }
        }
    }
    return paramCommentRelation;
}
function returnCommentWithLevel($trs) {
    let relation = {};
    let tabLen = 4;
    let tmpArr = [];
    $trs.each(function() {
        let $tds = $(this).find('td');
        if ($tds.length > 2) {
            let name = $($tds[0]).text();
            let comment = $($tds[2]).text().trim();

            let currentLevel = ((name.length - name.trimStart().length) / tabLen) + 1;
            let parent = getParent(tmpArr, currentLevel);
            let currentName = isNotBlank(parent) ? (parent.name + '.' + name.trim()) : name.trim();
            tmpArr.push({ level: currentLevel, name: currentName, value: comment });
        }
    });
    tmpArr.forEach(function(e) {
        if (isNotBlank(e.value)) {
            relation[e.name] = e.value;
        }
    });
    return relation;
}
function getParent(arr, currentLevel) {
    if (arr.length === 0 || currentLevel === 1) { return null; }

    let i;
    for (i = arr.length; i > 0; i--) {
        let ele = arr[i - 1];
        if (isNotBlank(ele) && ele.level === currentLevel - 1) {
            return ele;
        }
    }
    return null;
}
function relationBySource(sourceComment) {
    let comment = sourceComment.html();
    if (isBlank(comment)) {
        return null;
    }
    let firstEnd = '<div class="source">';
    comment = comment.substring(comment.indexOf(firstEnd) + firstEnd.length);
    comment = comment.replace(/<span class=".*?">|<\/span>/g, '').replace(/<\/div>/g, '');

    let relation = {};
    let tabLen = 2;
    let tmpArr = [];
    let i, lines = comment.split('\n');
    for (i = 0; i < lines.length; i++) {
        let line = lines[i];
        let lineTrim = line.trim();
        if (/".*?" : .*?/.test(lineTrim)) {
            let name = lineTrim.substring(1, lineTrim.indexOf('" : '));
            let start = ' /* ', end = ' */', strStart = '" : "', strEnd = '"';
            let paramComment = / \/\* .*? \*\/$/.test(lineTrim)
                ? lineTrim.substring(lineTrim.lastIndexOf(start) + start.length, lineTrim.length - end.length)
                : (/^".*?" : ".*?"/.test(lineTrim)
                    ? lineTrim.substring(lineTrim.indexOf(strStart) + strStart.length, lineTrim.lastIndexOf(strEnd))
                    : '');

            let currentLevel = (line.length - line.trimStart().length) / tabLen;
            let parent = getParent(tmpArr, currentLevel);
            let currentName = isNotBlank(parent) ? (parent.name + '.' + name.trim()) : name.trim();
            tmpArr.push({ level: currentLevel, name: currentName, value: paramComment });
        }
    }
    tmpArr.forEach(function(e) {
        if (isNotBlank(e.value)) {
            relation[e.name] = e.value;
        }
    });
    return relation;
}
function handleLineFieldRelation(json) {
    if (isBlank(json)) {
        return null;
    } else {
        let relation = {};
        let tabLen = 2;
        let tmpArr = [];
        let i, lines = json.split('\n');
        for (i = 0; i < lines.length; i++) {
            let line = lines[i];
            let lineTrim = line.trim();
            if (/".*?": .*?/.test(lineTrim)) {
                let name = lineTrim.substring(1, lineTrim.indexOf('": '));
                let currentLevel = (line.length - line.trimStart().length) / tabLen;
                let parent = getSourceParent(tmpArr, currentLevel);
                let currentName = isNotBlank(parent) ? (parent.name + '.' + name.trim()) : name.trim();
                tmpArr.push({ level: currentLevel, name: currentName, array: lineTrim.endsWith('": [') });
                relation[i.toString()] = currentName;
            }
        }
        return relation;
    }
}
function getSourceParent(arr, currentLevel) {
    if (arr.length === 0 || currentLevel === 1) { return null; }

    let i;
    for (i = arr.length; i > 0; i--) {
        let ele = arr[i - 1];
        if (isNotBlank(ele) && (ele.level === currentLevel - 1 || (ele.array === true && ele.level === currentLevel - 2))) {
            return ele;
        }
    }
    return null;
}
function getComment(lineFieldRelation, fieldCommentRelation, key) {
    let field = lineFieldRelation[key];
    if (isBlank(field)) {
        return null;
    }
    let comment = fieldCommentRelation[field];
    if (isNotBlank(comment)) {
        return comment;
    }

    let strAndIntKey = [];
    $.each(fieldCommentRelation, function(key) {
        let arr = key.split('.');
        let strArr = [];
        for (let i = 0; i < arr.length; i++) {
            if (arr[i] === '?') {
                strArr.push(i + ',?');
            } else if (arr[i] === '0') {
                strArr.push(i + ',0');
            }
        }
        let str = strArr.join('-');
        if (strAndIntKey.indexOf(str) === -1) {
            strAndIntKey.push(str);
        }
    });

    let fieldArr = field.split('.');
    let i;
    for (i = 0; i < strAndIntKey.length; i++) {
        let strAndInt = strAndIntKey[i];
        let arr = fieldArr.slice(0);
        strAndInt.split('-').forEach(function(e) {
            let split = e.split(',');
            if (split.length === 2) {
                arr[split[0]] = split[1];
            }
        });
        comment = fieldCommentRelation[arr.join('.')];
        if (isNotBlank(comment)) {
            return comment;
        }
    }
    return null;
}
function handleItem($val, value) {
    let key = $val.closest('.module-api').find('.anchor').attr('id') + ':' + $val.attr('name');
    if (isNotBlank(value)) {
        localStorage.setItem(key, value);
    } else {
        localStorage.removeItem(key);
    }
}
function handleInput($this, action, format) {
    let $source = $this.closest('.source-info');
    let $request = $source.find('.request-data-info');
    let value = getEditValue($request);
    if (isNotBlank(value)) {
        let itemKey = $this.closest('.module-api').find('.anchor').attr('id') + ':' + $request.attr('data-name');
        let $reqMsg = $source.find('.src-prev-req-msg');
        $reqMsg.html('');
        try {
            let json = action(JSON.stringify(JSON5.parse(value)));
            if (isNotBlank(json)) {
                setEditValue($request, json);
                localStorage.setItem(itemKey, json);
            } else {
                localStorage.removeItem(itemKey);
            }
            if (format) {
                $reqMsg.html('Comment on tail does not affect the Request');
                setTimeout(function () {
                    $reqMsg.html('');
                }, 3000);
            }
        } catch (e) {
            console.error('format json(' + value + ') error', e);
            $reqMsg.html('Json data error');
            setTimeout(function () {
                $reqMsg.html('');
            }, 3000);
        }
    }
}

$(function() {
    let linked = 1; /** init 1, change proejct: 2, all trigger scroll, 1 at scroll change active, 2 at scroll just set to 1 */

    $(document.body).scrollspy({target: '.bs-docs-sidebar'});

    $(document).on('change', '.project-choose', function() {
        linked = 2;
        let projectUrl = $(this).find('option:selected').data('url');
        let hash = isBlank(projectUrl) ? '' : ('?p=' + $(this).val());
        history.replaceState({api: $(this).val()}, '', location.pathname + hash);
        loadData();
    });

    $(document).on('click', '.tab', function() {
        let $this = $(this);
        let $parent = $this.parent();
        if (!$parent.hasClass('active')) {
            $parent.parent().find('.active').removeClass('active');
            $parent.addClass('active');

            let $content = $this.closest('.module-api-info').find('.tab-content');
            $content.find('.active').removeClass('in active');
            $content.children().eq($parent.index()).addClass('in active');

            let link = $this.closest('.module-api').find('.anchor').attr('id');
            let tab = $this.attr('data-tab');
            if (String(tab) === '1') {
                localStorage.setItem(link, tab);
            } else {
                localStorage.removeItem(link);
            }
        }
    });

    $(document).on('change', '.form-file', function() {
        let $this = $(this);
        $this.parents('.input-group').find(':text').val($this.val());
    });

    $(document).on('change', '.has-token', function() {
        let $this = $(this);
        let name = $this.attr('name');
        let value = $this.val();
        let key = '$global-header-' + name;
        if (isNotBlank(value)) {
            localStorage.setItem(key, value);
        } else {
            localStorage.removeItem(key);
        }
        $('[name="' + name + '"]').val(value);
    });

    $(document).on('change', '.data-info', function() {
        let $this = $(this);
        handleItem($this, $this.val());
    });

    $(document).on('click', '.src-prev-req-format', function() {
        let $formParent = $(this).closest('.module-api-info');
        handleInput($(this), function(json) {
            return addComment(escapeHtml(JSON.stringify(JSON5.parse(json), null, 2)), $formParent, false);
        }, true);
    });

    $(document).on('click', '.src-prev-req-compress', function() {
        handleInput($(this), function(json) {
            return JSON.stringify(JSON5.parse(json));
        }, false);
    });

    $(document).on('click', '.form-submit', function() {
        let $btn = $(this);
        let $form = $btn.closest('form');
        let $formParent = $form.closest('.module-api-info');
        let $curl = $form.find('.curl');
        let $response = $form.find('.response');
        let $reqMsg = $form.find('.src-prev-req-msg');
        $curl.hide();
        $response.hide();
        $reqMsg.html('');

        $.validationEngine.defaults.scroll = false;
        let flag = $form.validationEngine('validate', { scroll: false });
        if (!flag) {
            return;
        }

        let projectDomain = getProjectDomain();
        let method = $form.attr('method');
        let url = $form.attr('action');
        if (isBlank(url)) {
            url = '';
        }
        let hasRequestBody = String($form.attr('request-body')) === '1';
        if (isBlank(method)) {
            method = hasRequestBody ? 'POST' : 'GET';
        }
        let hasBasicParamRequestBody = String($form.attr('basic-param-request-body')) === '1';

        let requestBody = getEditValue($form.find('.request-data-info'));
        if (isNotBlank(requestBody)) {
            try {
                requestBody = JSON.stringify(JSON5.parse(requestBody));
            } catch (e) {
                console.error('parse(' + requestBody + ') error', e);
                $reqMsg.html('Json date error!');
                setTimeout(function () { $reqMsg.html(''); }, 3000);
                return;
            }
        }

        let map = objectifyForm($form);
        let params = map[0];
        let headers = map[1];
        let files = map[2];

        if (!url.toLowerCase().startsWith('http://') && !url.toLowerCase().startsWith('https://')) {
            if (!url.startsWith('/')) {
                url = '/' + url;
            }
            url = projectDomain + url;
        }

        let placeRegex = /{(.*?)}/;
        while (placeRegex.test(url)) {
            let group = RegExp.$1;
            let value = params[group];
            /* url /user/{id} change to /user/123, params <name=xyz&id=&gender=1> change to <name=xyz&gender=1> */
            url = url.replace(placeRegex, value);
            delete params[group];
        }


        let tmpUrl = url;
        let line = ' \\\n';
        let curlHtml = 'curl -i -X ' + method + line;
        curlHtml += "&nbsp; -A '" + navigator.userAgent + "'" + line;
        if (isNotBlank(document.cookie)) {
            curlHtml += "&nbsp; -b '" + document.cookie + "'" + line;
        }
        if (Object.getOwnPropertyNames(headers).length > 0) {
            $.each(headers, function(key, value) {
                if (isNotBlank(key) && isNotBlank(value)) {
                    curlHtml += "&nbsp; -H '" + (key + ': ' + value) + "'" + line;
                }
            });
        }
        if (hasRequestBody) {
            curlHtml += "&nbsp; -H 'Content-Type: application/json'" + line;
            curlHtml += "&nbsp; -H 'Accept: application/json'" + line;
        }
        if (files.length > 0) {
            if (Object.getOwnPropertyNames(params).length > 0) {
                $.each(params, function(key, value) {
                    if (isNotBlank(key) && isNotBlank(value)) {
                        curlHtml += "&nbsp; -F '" + (key + '=' + value) + "'" + line;
                    }
                });
            }
            $.each(files, function(i, file) {
                let fileName = file.name;
                let filePath = file.value;
                if (isNotBlank(fileName) && isNotBlank(filePath)) {
                    filePath = filePath.replace('C:\\fakepath\\', '/$REPLACE_REAL_PATH$/');
                    curlHtml += "&nbsp; -F '" + (fileName + '=@' + filePath) + "'" + line;
                }
            });
        } else {
            if (isNotBlank(requestBody)) {
                curlHtml += "&nbsp; -d '" + requestBody + "'" + line;
            } else if (Object.getOwnPropertyNames(params).length > 0) {
                if (hasRequestBody) {
                    if (hasBasicParamRequestBody) {
                        curlHtml += "&nbsp; -d '" + params[Object.keys(params)[0]] + "'" + line;
                    } else {
                        curlHtml += "&nbsp; -d '" + JSON.stringify(params) + "'" + line;
                    }
                } else {
                    if ('GET' === method.toUpperCase()) {
                        let paramArr = [];
                        $.each(params, function(key, value) {
                            if (isNotBlank(key) && isNotBlank(value)) {
                                paramArr.push(key + '=' + value);
                            }
                        });
                        let paramStr = paramArr.join('&');
                        if (paramStr.length > 0) {
                            tmpUrl += (url.includes('?') ? '&' : '?') + paramStr;
                        }
                    } else {
                        $.each(params, function(key, value) {
                            if (isNotBlank(key) && isNotBlank(value)) {
                                curlHtml += "&nbsp; -d '" + (key + '=' + value) + "'" + line;
                            }
                        });
                    }
                }
            }
        }
        curlHtml += "&nbsp; --url '" + (tmpUrl.startsWith('//') ? (location.protocol + tmpUrl) : tmpUrl) + "'";
        curlHtml = curlHtml.replace(/&nbsp;/g, ' ');
        if (curlHtml.length <= 100) {
            curlHtml = curlHtml.replace(new RegExp(line.replace('\\', '\\\\'), 'g'), '');
            if (!curlHtml.includes('\\')) {
                curlHtml = curlHtml.replace(/\s{2,}/g, ' ');
            }
        }
        $curl.find('.source-code').html(addLine(curlHtml));
        $curl.show();


        let settings = {
            url: url,
            method: method,
            beforeSend: function(request) {
                if (Object.getOwnPropertyNames(headers).length > 0) {
                    $.each(headers, function(key, value) {
                        if (isNotBlank(key) && isNotBlank(value)) {
                            request.setRequestHeader(key, value);
                        }
                    });
                }
            }
        };

        let locationDomain = location.protocol + '//' + location.host;
        if (isNotBlank(projectDomain) && locationDomain !== projectDomain && !projectDomain.startsWith(locationDomain + '/')) {
            settings.crossDomain = true;
            settings.xhrFields = { withCredentials: true };
        }
        if (files.length > 0) {
            if ('POST' !== method.toUpperCase()) {
                $response.find('.source-code').html("<span class='red'>Upload files must use POST(It's possible to use the above cURL), please contact the backend to change!</span>");
                $response.show();
                return;
            }

            let formData = new FormData();
            $.each(params, function(key, value) {
                if (isNotBlank(key) && isNotBlank(value)) {
                    formData.append(key, value);
                }
            });
            $.each(files, function(i, f) {
                formData.append(f.name, f.files[0]);
            });

            settings['data'] = formData;
            settings['cache'] = false;
            settings['processData'] = false;
            settings['contentType'] = false;
        } else {
            if (hasRequestBody) {
                if ('GET' === method.toUpperCase()) { /* https://stackoverflow.com/questions/978061/http-get-with-request-body */
                    $response.find('.source-code').html("<span class='red'>Browser cannot send RequestBody parameter via a GET request" +
                        "(It's possible to use the above cURL), please contact the backend change to POST!</span>");
                    $response.show();
                    return;
                }
                settings['contentType'] = 'application/json';
                settings['dataType'] = 'json';
                if (isNotBlank(requestBody)) {
                    settings['data'] = requestBody;
                } else if (hasBasicParamRequestBody) {
                    settings['data'] = Object.getOwnPropertyNames(params).length > 0 ? params[Object.keys(params)[0]] : '';
                } else {
                    settings['data'] = JSON.stringify(params);
                }
            } else {
                settings['data'] = params;
            }
        }

        let $responseData = $response.find('.result-data-info');
        let start = new Date().getTime();
        $btn.attr('disabled', 'disabled');
        $btn.addClass('disabled');
        let $resultData = $response.find('.result-data');
        let $runLog = $btn.closest('form').find('.src-prev-res-msg');
        let $action = $response.find('.src-prev-right');
        $.ajax(settings).done(function(result) {
            $runLog.html(timeLog(start));
            let html;
            let fail = isBlank(result);
            if (fail) {
                $resultData.css('height', 'unset');
                $action.css('display', 'none');
                html = '<div class="green">' + method + ' request (' + url + ') success, but response has empty</div>';
            } else {
                $resultData.css('height', '');
                $action.css('display', '');
                html = addComment(escapeHtml(JSON.stringify(result, null, 2)), $formParent, true);
            }
            $responseData.css({'white-space':'','flex-direction':'','padding':''});
            if (!fail) {
                let editor = ace.edit($responseData[0]);
                let session = editor.getSession();
                session.setOptions({ tabSize: 2, useSoftTabs: false });
                session.setUseWrapMode(true);
                session.setUseWorker(false);
                session.setMode("ace/mode/json");
                session.setValue(html, -1);
                editor.setTheme("ace/theme/chrome");
                editor.setAutoScrollEditorIntoView(true);
                editor.setShowPrintMargin(false);
                editor.setReadOnly(true);

                let oldHeight = $resultData.css('height');
                let originalHeight = isNotBlank(oldHeight) ? (parseFloat(oldHeight.substring(0, oldHeight.indexOf('px'))) || 0) : 0;
                let maxHeight = 17 * html.split('\n').length;
                if (maxHeight > 0 && originalHeight > maxHeight) {
                    $resultData.css('height', maxHeight);
                    editor.resize();
                }
            } else {
                $responseData.html(html);
            }
            $response.show();
            $btn.removeAttr('disabled');
            $btn.removeClass('disabled');
        }).fail(function(error) {
            $resultData.css('height', 'unset');
            $action.css('display', 'none');
            $runLog.html(timeLog(start));
            let html = '';
            if (isBlank(error)) {
                html += '<div class="red">' + method + ' (' + url + ') fail</div>';
            } else {
                html += '<div class="red">Response Code: ' + error.status + '</div>';
                let json = error.responseJSON;
                if (isNotBlank(json)) {
                    html += '\n\n' + escapeHtml(JSON.stringify(json, null, 2));
                } else {
                    let text = error.responseText;
                    if (isNotBlank(text)) {
                        html += '<div class="red wrap" style="margin-top:7px;">Response Text: ' + escapeHtml(text) + '</div>';
                    } else {
                        html += '<div class="red wrap" style="margin-top:7px;">The response is empty</div>';
                    }
                }
            }
            $responseData.css({'white-space':'pre-wrap','flex-direction':'column','padding':'7px'});
            $responseData.html(html);
            $response.show();
            $btn.removeAttr('disabled');
            $btn.removeClass('disabled');
        });
    });

    $(document).on('click', '.right-arrow', function() {
        let $nav = $('.col-md-3');
        let $content = $('.col-md-9');

        let $img = $(this).find('.img');
        if (String($img.attr('style')).includes('rotate(180deg)')) {
            $img.css('transform', '');
            $nav.css('width', '');
            $content.css('width', '');
            localStorage.removeItem(rightArrowKey);
        } else {
            $img.css('transform', 'rotate(180deg)');
            $nav.css('width', '0');
            $content.css('width', '100%');
            localStorage.setItem(rightArrowKey, '1');
        }
        $nav.on('transitionend webkitTransitionEnd oTransitionEnd', function () {
            allResize();
        });
    });

    $('#config-prefix-url').on('show.bs.modal', function () {
        $('#prefix-url').val(localStorage.getItem(localServerPathItem));
    });
    $(document).on('click', '#delete-prefix', function() {
        localStorage.removeItem(localServerPathItem);
        loadMulti();
    });
    $(document).on('keydown', '#prefix-url', function(e) {
        if (hasEnter(e)) {
            newRequest();
        }
    });
    $(document).on('click', '.config-btn', function() {
        newRequest();
    });

    $(document).on('click', '.no-scroll', function() {
        let display = 'No-Scroll', scroll = 'Scroll';
        let $this = $(this);
        let $sourceInfo = $this.closest('.source-info');
        let $source = $sourceInfo.find('.source-code');
        if ($source.length !== 0) {
            if ($source.css('max-height') === 'none') {
                $source.css('max-height', '');
                $this.html(display);
            } else {
                $source.css('max-height', 'unset');
                $this.html(scroll);
            }
        } else {
            $source = $sourceInfo.find('.request-data');
            if ($source.length === 0) {
                $source = $sourceInfo.find('.result-data');
            }
            let $editElement = $sourceInfo.find('.request-data-info');
            if ($editElement.length === 0) {
                $editElement = $sourceInfo.find('.result-data-info');
            }
            let height = getValueHeight($editElement);
            let oldHeight = $source.css('max-height');
            let originalHeight = isNotBlank(oldHeight) ? (parseFloat(oldHeight.substring(0, oldHeight.indexOf('px'))) || 0) : 0;
            let valueHeight = height + 'px';
            $source.css('height', valueHeight);
            if (oldHeight === valueHeight || originalHeight >= height) {
                $source.css('max-height', '');
                $this.html(display);
            } else {
                $source.css('max-height', valueHeight);
                $this.html(scroll);
            }
            resizeEdit($editElement);
        }
    });
    $(document).on('click', '.copy', function() {
        let $this = $(this);
        let $sourceInfo = $this.closest('.source-info');
        let $source = $sourceInfo.find('.source');
        let copyValue;
        if ($source.length !== 0) {
            copyValue = $source.text();
        } else {
            let $copyElement = $sourceInfo.find('.request-data-info');
            if ($copyElement.length === 0) {
                $copyElement = $sourceInfo.find('.result-data-info');
            }
            copyValue = getEditValue($copyElement);
        }
        if (isNotBlank(copyValue)) {
            copyValue = copyValue.replace(/<.*?>/g, '');

            let arr = copyValue.split('\n');
            let i, len = arr.length;
            let strArr = [];
            for (i = 0; i < len; i++) {
                strArr.push(arr[i].replace(/([ ]*?)\/\*.*?\*\/$/, '').replace(/([ ]*?)\/\/.*?$/, ''));
            }
            copyValue = strArr.join('\n');
        }
        if (isBlank(copyValue)) {
            return;
        }
        let $copyStatus = $this.prev();
        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(copyValue).then(
                function () {
                    $copyStatus.text('Copy Success!');
                    setTimeout(function () { $copyStatus.text(''); }, 3000);
                },
                function () {
                    /* $copyStatus.text('Opps! Your browser does not support the Clipboard API'); */
                    commandCopy($this, copyValue, $copyStatus);
                }
            );
        } else {
            commandCopy($this, copyValue, $copyStatus);
        }
    });
    function commandCopy($ele, copyValue, $copyStatus) {
        let copyElement = document.createElement('textarea');
        copyElement.setAttribute('readonly', 'readonly');
        copyElement.setAttribute('class', 'copy-impl');
        $(copyElement).html(copyValue); /* 「copyElement.value = copyValue;」 not active */

        let $parent = $ele.parent()[0];
        $parent.appendChild(copyElement);
        copyElement.setSelectionRange(0, copyValue.length);
        copyElement.select();
        let flag = document.execCommand('copy');
        $parent.removeChild(copyElement);

        $copyStatus.text('Copy ' + (flag ? 'Success' : 'Fail'));
        setTimeout(function() { $copyStatus.text(''); }, 3000);
    }

    $(window).scroll(function() {
        let headerHeight = 51;
        let topBottomHeight = 30;
        let scrolled = 'scrolled';
        let heightProperty = 'max-height';

        let html = document.getElementsByTagName('html')[0];
        let footer = document.getElementsByTagName('footer')[0];

        let $win = $(window);
        let $nav = $('.col-md-3');
        let $bar = $('.bs-docs-sidebar > .nav');

        let $header = $('header');
        let scrollTop = $win.scrollTop();
        if (scrollTop > 0) {
            if (!$header.hasClass(scrolled)) {
                $header.addClass(scrolled);
            }
        } else {
            $header.removeClass(scrolled);
        }

        if ($nav.css('display') !== 'none') {
            let footerTop = footer.offsetTop;
            let pageHeight = scrollTop + $win.height();
            if (footerTop >= scrollTop && footerTop < pageHeight) {
                let footViewHeight = pageHeight - footerTop;
                $bar.css(heightProperty, 'calc(100vh - ' + (headerHeight + topBottomHeight + footViewHeight) + 'px)');
            } else {
                let htmlViewHeight = (html.clientHeight - headerHeight - topBottomHeight) + 'px';
                if ($bar.css(heightProperty) !== htmlViewHeight) {
                    $bar.css(heightProperty, 'calc(100vh - ' + (headerHeight + topBottomHeight) + 'px)');
                }
            }

            let navHash = $nav.find('.active > a:last').attr('href');
            let currentHash = location.hash;
            if (navHash !== currentHash) {
                let url = location.pathname + location.search;
                if (isBlank(navHash)) {
                    if ($header.hasClass(scrolled) !== true) {
                        history.replaceState({api: 'index'}, '', url);
                    }
                    if (linked === 1) {
                        linked = 0;
                        let $anchor = $(currentHash);
                        if ($anchor.length > 0) {
                            let $li = $('a[href="' + currentHash + '"]').parents('li');
                            if (!$li.hasClass('active')) {
                                $li.addClass('active');
                            }
                        }
                    } else if (linked === 2) {
                        linked = 1;
                    }
                } else {
                    history.replaceState({api: navHash}, '', url + navHash);
                }
            }
        }
    });
});
</script>
</body>
</html>
