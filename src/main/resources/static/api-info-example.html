<!doctype html> <html lang="zh-CN"> <head> <title>接口文档</title> <meta charset="utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"> <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css"> <link rel="stylesheet" href="//cdn.bootcss.com/jQuery-Validation-Engine/2.6.4/validationEngine.jquery.min.css"> <style type="text/css"> html { position: relative; min-height: 100%; } body { font-size: 16px; margin-bottom: 105px; } footer { position: absolute; bottom: 0; width: 100%; height: 127px; background-color: #f5f5f5; } footer > div { padding: 10px; } footer p { margin: 0 0 5px; text-align: center; font-size: 16px; } .container { width: auto; } .col-md-9 { width: 80%; } .col-md-3 { width: 20%; } #table-of-contents { margin-top: 20px; margin-bottom: 20px; } input { width: 180px; } textarea { width: 180px; } blockquote p { font-size: 18px; } pre { font-size: 14px; overflow: auto; margin: 0 0 1em; padding: .5em 1em; } pre .line-number { color: #2B91AF; display: block; float: left; margin: 0 1em 0 -1em; border-right: 1px solid; text-align: right; padding: 0 .5em 0 1em; } pre .comment { color: #998; font-style: italic; } .curl, .response { display: none; } figcaption { font-size: 16px; color: #666; font-style: italic; padding-bottom: 15px; } .table-hover tbody tr:hover { background-color: rgba(0,0,0,.075); } .table-striped tbody tr:nth-of-type(odd) { background-color: rgba(0,0,0,.05); } .table-bordered td, .table-bordered th { border: 1px solid #dee2e6; } .bs-docs-sidebar.affix { position: static; } @media (min-width: 768px) { .bs-docs-sidebar { padding-left: 20px; } } .bs-docs-sidebar > .nav { overflow-y: auto; max-height: 76vh; } .bs-docs-sidebar .nav > li > a { display: block; padding: 4px 20px; font-size: 14px; font-weight: 500; color: #999; } .bs-docs-sidebar .nav > li > a:hover, .bs-docs-sidebar .nav > li > a:focus { padding-left: 19px; color: #A1283B; text-decoration: none; background-color: transparent; border-left: 1px solid #A1283B; } .bs-docs-sidebar .nav > .active > a, .bs-docs-sidebar .nav > .active:hover > a, .bs-docs-sidebar .nav > .active:focus > a { padding-left: 18px; font-weight: bold; color: #A1283B; background-color: transparent; border-left: 2px solid #A1283B; } .bs-docs-sidebar .nav .nav { display: none; padding-bottom: 10px; } .bs-docs-sidebar .nav .nav > li > a { padding-top: 1px; padding-bottom: 1px; padding-left: 30px; font-size: 12px; font-weight: normal; } .bs-docs-sidebar .nav .nav > li > a:hover, .bs-docs-sidebar .nav .nav > li > a:focus { padding-left: 29px; } .bs-docs-sidebar .nav .nav > .active > a, .bs-docs-sidebar .nav .nav > .active:hover > a, .bs-docs-sidebar .nav .nav > .active:focus > a { padding-left: 28px; font-weight: 500; } .bs-docs-sidebar .nav .nav .nav { padding-bottom: 10px; } .bs-docs-sidebar .nav .nav .nav > li > a { padding-top: 1px; padding-bottom: 1px; padding-left: 40px; font-size: 12px; font-weight: normal; } .bs-docs-sidebar .nav .nav .nav > li > a:hover, .bs-docs-sidebar .nav .nav .nav > li > a:focus { padding-left: 39px; } .bs-docs-sidebar .nav .nav .nav > .active > a, .bs-docs-sidebar .nav .nav .nav > .active:hover > a, .bs-docs-sidebar .nav .nav .nav > .active:focus > a { padding-left: 38px; font-weight: 500; } @media (min-width: 992px) { .bs-docs-sidebar .nav > .active > ul { display: block; } .bs-docs-sidebar.affix, .bs-docs-sidebar.affix-bottom { width: 213px; } .bs-docs-sidebar.affix { position: fixed; top: 20px; } .bs-docs-sidebar.affix-bottom { position: absolute; } .bs-docs-sidebar.affix .bs-docs-sidenav, .bs-docs-sidebar.affix-bottom .bs-docs-sidenav { margin-top: 0; margin-bottom: 0 } } @media (min-width: 1200px) { .bs-docs-sidebar.affix-bottom, .bs-docs-sidebar.affix { width: 263px; } } </style> </head> <body> <div class="container"> <div class="row"> <div class="col-md-9"> <script id="url-render" type="text/x-dot-template"> {{~ it.moduleList :value:index}} <div class="outline-2"> <h2 id="{{= value.name}}"><span class="section-number-2">{{= index + 1}}</span> {{= value.info}}</h2> {{~ value.urlList :url:urlIndex}} <div class="outline-3"> <h3 id="{{= value.name}}-{{= url.id}}"> <span class="section-number-3">{{= index + 1}}.{{= urlIndex + 1}}</span> {{= url.title}} </h3> <div class="outline-text-3"> <pre class="example">{{? url.develop && url.develop !== ''}}开发: {{= url.develop}}<br>{{?}}{{? url.desc && url.desc !== ''}}说明: {{= url.desc}}<br>{{?}}{{? (url.develop && url.develop !== '') || (url.desc && url.desc !== '')}}<br>{{?}}<a target="_blank" href="{{= url.exampleUrl}}">响应结果示例地址</a></pre> <p> 接口地址 <code>{{= url.method}} {{= url.url}}</code></p> <p>响应示例及说明如下</p> <div class="org-src-container"> <pre class="src src-json">{{= url.commentJson || '<span style="color:red">响应为空 或 响应不明确</span>'}}</pre> {{? url.returnList && url.returnList.length > 0}} <table class="table table-striped table-bordered table-hover table-condensed"> <thead> <tr> <th scope="col" class="text-left">名称</th> <th scope="col" class="text-left">类型</th> <th scope="col" class="text-left">说明</th> </tr> </thead> <tbody> {{~ url.returnList :rtn}} <tr> <td class="text-left">{{= rtn.name}}</td> <td class="text-left">{{= rtn.type}}</td> <td class="text-left" style="white-space:pre-wrap;">{{= rtn.desc}}</td> </tr> {{~}} </tbody> </table> {{?}} {{? (it.responseList && it.responseList.length > 0) || (url.responseList && url.responseList.length > 0)}} <table class="table table-striped table-bordered table-hover table-condensed"> <thead> <tr> <th scope="col" class="text-left">响应状态码</th> <th scope="col" class="text-left">说明</th> </tr> </thead> <tbody> {{ let responseList; if (url.responseList && url.responseList.length > 0) { responseList = url.responseList; } else if (it.responseList && it.responseList.length > 0) { responseList = it.responseList; } else { responseList = []; } }} {{~ responseList :response}} <tr> <td class="text-left">{{= response.code}}</td> <td class="text-left">{{= response.msg}}</td> </tr> {{~}} </tbody> </table> {{?}} </div> <form method="{{= url.method}}" action="{{= url.url}}"{{? url.hasFile}} enctype="multipart/form-data"{{?}}> {{? url.paramList && url.paramList.length > 0}} <p>参数说明如下</p> <table class="table table-striped table-bordered table-hover table-condensed"> <thead> <tr> <th scope="col" class="text-left">名称</th> <th scope="col" class="text-left">说明</th> <th scope="col" class="text-left">必须</th> <th scope="col" class="text-left">数据类型</th> {{? url.hasHeader}}<th scope="col" class="text-left">参数类型</th>{{?}} <th scope="col" class="text-left">示例</th> </tr> </thead> <tbody> {{~ url.paramList :param:paramIndex}} <tr{{? param.must}} style="font-weight: bold;"{{?}}> <td class="text-left">{{= param.name}}</td> <td class="text-left" style="white-space:pre-wrap;">{{= param.desc}}</td> <td class="text-left">{{? param.must}}Yes{{??}}No{{?}}</td> <td class="text-left">{{= param.dataType}}</td> {{? url.hasHeader}}<td class="text-left">{{= param.paramType}}</td>{{?}} <td class="text-left"> {{ let arr = []; if (param.must) { arr.push('required'); } if (param.dataType === 'int' || param.dataType === 'long') { arr.push('custom[integer]'); } else if (param.dataType === 'float' || param.dataType === 'double') { arr.push('custom[number]'); } else if (param.dataType === 'email') { arr.push('custom[email]'); } else if (param.dataType === 'url') { arr.push('custom[url]'); } else if (param.dataType === 'ipv4') { arr.push('custom[ipv4]'); } let arrJoin = arr.filter(function(e){ return e !== undefined && e !== null && e !== ''; }).join(','); let validateData = (arrJoin !== undefined || arrJoin !== null || arrJoin !== "") ? (' class="validate[' + arrJoin + ']"') : ''; let header = ('Header' === param.paramType) ? ' header="true"' : ''; }} {{? param.dataType === 'file' }} <input name="{{= param.name}}" type="file"{{= validateData}}/> {{?? param.hasTextarea}} <textarea name="{{= param.name}}"{{= header}}{{= validateData}}>{{= param.example}}</textarea> {{??}} <input name="{{= param.name}}"{{= header}}{{= validateData}} value="{{= param.example}}"/> {{?}} <!-- 当表单上只有一个 input 时, 加多一个不可见的 input 可以禁用那个 input 的回车事件 --> <input style="display:none;"/> </td> </tr> {{~}} </tbody> </table> {{?}} <p><input type="button" value="请求此接口" onclick="request(this);"/></p> <div class="curl"><pre class="src src-json"></pre></div> <div class="response"><pre class="src src-json"></pre></div> </form> <hr/> </div> </div> {{~}} </div> {{~}} </script> </div> <div class="col-md-3"> <nav id="table-of-contents"> <div class="bs-docs-sidebar"> <ul class="nav"> <script id="url-nav-render" type="text/x-dot-template"> {{~ it.moduleList :value:index}} <li> <a href="#{{= value.name}}">{{= index + 1}} {{= value.info}}</a> <ul class="nav"> {{~ value.urlList :url:urlIndex}} <li> <a href="#{{= value.name}}-{{= url.id}}">{{= index + 1}}.{{= urlIndex + 1}} {{= url.title}}</a> </li> {{~}} </ul> </li> {{~}} </script> </ul> </div> </nav> </div> </div> </div> <footer class="postamble"> <script id="copyright" type="text/x-dot-template"> <div> <p class="statistics">共 {{= it.groupCount}} 个模块, {{= it.apiCount}} 个接口</p> <p class="version">版本: {{= it.version}}</p> <p class="team">团队: {{= it.team}}</p> <p class="copyright">&copy;{{= new Date().getFullYear()}} {{= it.copyright}}</p> </div> </script> </footer> <script> let projectDomain = ""; </script> <script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script> <script src="//cdn.bootcss.com/twitter-bootstrap/3.3.5/js/bootstrap.min.js"></script> <script type="text/javascript"> $(function() { 'use strict'; $(document.body).scrollspy({target: '.bs-docs-sidebar'}); $('.bs-docs-sidebar').affix(); }); </script> <script src="//cdn.bootcss.com/dot/1.1.2/doT.min.js"></script> <script type="text/javascript"> function isBlank(str) { return str === undefined || str === null || str === ""; } function isNotBlank(str) { return !isBlank(str); } function addLine(html) { if (isBlank(html)) { return ""; } let lineNum = html.split(/\n/).length; let lineHtml = '<span class="line-number">'; for (let i = 0; i < lineNum; i++) { lineHtml += (i + 1) + '\n'; } lineHtml = lineHtml.trim(); lineHtml += '</span>'; return lineHtml + html; } let locationDomain = window.location.protocol + "//" + window.location.host; if (isNotBlank(projectDomain) && locationDomain !== projectDomain && !projectDomain.startsWith(locationDomain + "/")) { $.ajaxSetup({ crossDomain: true, xhrFields: { withCredentials: true } }); } let main = $(".col-md-9"); $.get(projectDomain + "/api/info", function (data) { if (isNotBlank(data)) { let documentInfo; if (typeof data === "string") { documentInfo = JSON.parse(data); } else { documentInfo = data; } { let copyright = documentInfo.copyright; if (isNotBlank(copyright.title)) { $("title").html(copyright.title); } let copyrightRender = $("#copyright"); let template = doT.template(copyrightRender.html()); copyrightRender.parent().html(template(copyright)); } { let doc = documentInfo.document; let urlRender = $("#url-render"); let urlRenderTemplate = doT.template(urlRender.html()); urlRender.parent().html(urlRenderTemplate(doc)); let navRender = $("#url-nav-render"); let navRenderTemplate = doT.template(navRender.html()); navRender.parent().html(navRenderTemplate(doc)); $("pre[class='src src-json']").each(function () { let html = $(this).html(); if (isNotBlank(html)) { html = html.replace(/(.*?)(\/\*.*?\*\/)/g, "$1<span class=\"comment\">$2</span>"); $(this).html(addLine(html)); } }); let href = window.location.href; if (href.includes("#")) { href = href.substring(href.indexOf("#"), href.length); let anchor = $(href); if (anchor.length > 0) { let li = $("a[href='" + href + "']").parent(); li.addClass("active"); li.parent().parent().addClass("active"); $("html,body").animate({scrollTop: anchor.offset().top}, 0); } } else { $('.bs-docs-sidebar li').first().addClass('active'); } } } else { main.html("<span style='color:red;'>无接口信息</span>"); } }).error(function () { main.html("<span style='color:red;'>接口请求错误</span>"); }); </script> <script src="//cdn.bootcss.com/jQuery-Validation-Engine/2.6.4/languages/jquery.validationEngine-zh_CN.min.js"></script> <script src="//cdn.bootcss.com/jQuery-Validation-Engine/2.6.4/jquery.validationEngine.min.js"></script> <script type="text/javascript"> if (isBlank(projectDomain)) { projectDomain = window.location.protocol + "//" + window.location.host; } if (projectDomain.endsWith("/")) { projectDomain = projectDomain.substring(0, projectDomain.length - 1); } $.validationEngine.defaults.scroll = false; function request(obj) { let form = $(obj).parents("form"); let curl = form.find(".curl"); let response = form.find(".response"); curl.hide(); response.hide(); let flag = form.validationEngine("validate"); if (!flag) { return; } let method = form.attr('method'); let url = form.attr('action'); let map = objectifyForm(form); let params = map[0]; let headers = map[1]; let files = map[2]; if (!url.toLowerCase().startsWith("http://") && !url.toLowerCase().startsWith("https://")) { if (!url.startsWith("/")) { url = "/" + url; } url = projectDomain + url; } let placeRegex = /{(.*?)}/; while (placeRegex.test(url)) { let group = RegExp.$1; let value = params[group]; url = url.replace(placeRegex, value); delete params[group]; } { let tmpUrl = url; let line = " \\\n"; let curlHtml = "curl -i -X " + method + line; if (files.length > 0) { if (Object.getOwnPropertyNames(params).length > 0) { $.each(params, function (key, value) { if (isNotBlank(key) && isNotBlank(value)) { curlHtml += "&nbsp; -F '" + (key + "=" + value) + "'" + line; } }); } $.each(files, function(i, file) { let fileName = file.name; let filePath = file.value; if (isNotBlank(fileName) && isNotBlank(filePath)) { filePath = filePath.replace("C:\\fakepath\\", "/$替换真实路径$/"); curlHtml += "&nbsp; -F '" + (fileName + "=@" + filePath) + "'" + line; } }); } else { if (Object.getOwnPropertyNames(params).length > 0) { if ("GET" === method.toUpperCase()) { let paramArr = []; $.each(params, function (key, value) { if (isNotBlank(key) && isNotBlank(value)) { paramArr.push(key + "=" + value); } }); let paramStr = paramArr.join("&"); if (paramStr.length > 0) { tmpUrl += (url.includes("?") ? "&" : "?") + paramStr; } } else { $.each(params, function (key, value) { if (isNotBlank(key) && isNotBlank(value)) { curlHtml += "&nbsp; -d '" + (key + "=" + value) + "'" + line; } }); } } } if (Object.getOwnPropertyNames(headers).length > 0) { $.each(headers, function (key, value) { if (isNotBlank(key) && isNotBlank(value)) { curlHtml += "&nbsp; -H '" + (key + ": " + value) + "'" + line; } }); } curlHtml += "&nbsp; --url '" + tmpUrl + "'"; curlHtml = curlHtml.replace(/&nbsp;/g, " "); if (curlHtml.length <= 120) { curlHtml = curlHtml.replace(new RegExp(line.replace("\\", "\\\\"), "g"), ""); if (!curlHtml.includes("\\")) { curlHtml = curlHtml.replace(/\s{2,}/g, " "); } } curl.find("pre").html(curlHtml); curl.show(); } { let settings = { url: url, method: method, beforeSend: function (request) { if (Object.getOwnPropertyNames(headers).length > 0) { $.each(headers, function (key, value) { if (isNotBlank(key) && isNotBlank(value)) { request.setRequestHeader(key, value); } }); } } }; if (files.length > 0) { if ('POST' !== method.toUpperCase()) { response.find("pre").html("<span style='color:red;'>上传文件需要用 POST(用上面的 cURL 是可以的), 请联系后端修改!</span>"); response.show(); return; } let formData = new FormData(); $.each(params, function (key, value) { if (isNotBlank(key) && isNotBlank(value)) { formData.append(key, value); } }); $.each(files, function(i, f) { formData.append(f.name, f.files[0]); }); settings['data'] = formData; settings['cache'] = false; settings['processData'] = false; settings['contentType'] = false; } else { settings['data'] = params; } let responseData = response.find("pre"); let start = new Date().getTime(); $.ajax(settings).done(function (result) { let html = timeLog(start); if (isBlank(result)) { html += "<span style='color:green;'>" + method + " 请求(" + url + ")成功, 但是响应为空</span>"; } else { html += addLine(escapeHtml(JSON.stringify(result, null, 2))); } responseData.html(html); response.show(); }).fail(function (error) { let html = timeLog(start); if (isBlank(error)) { html += "<span style='color:red;'>" + method + " 请求(" + url + ")失败</span>"; } else { html += "<span style='color:red;'>响应状态码: " + error.status + "</span>"; let json = error.responseJSON; if (isNotBlank(json)) { html += "\n\n" + addLine(escapeHtml(JSON.stringify(json, null, 2))); } else { let text = error.responseText; if (isNotBlank(text)) { html += "\n<span style='color:red;white-space:pre-wrap;'>响应文本: " + escapeHtml(text) + "</span>"; } else { html += "\n<span style='color:red;'>响应为空</span>"; } } } responseData.html(html); response.show(); }); } } function timeLog(start) { let end = new Date().getTime(); return "请求时长: " + (end - start) + "ms\n" + formatDate(start) + " -> " + formatDate(end) + "\n\n"; } function objectifyForm(form) { let headers = {}; let params = {}; $.each(form.serializeArray(), function(i, field) { let name = field.name; let value = field.value; let input = form.find("input[name=" + name + "]"); let header = input.attr("header"); if (header && header === "true") { headers[name] = value; } else { params[name] = value; } }); return [params, headers, form.find('input[type="file"]')]; } function escapeHtml(html) { if (isBlank(html)) { return null; } return html.replace(/&/g, "&amp;") .replace(/</g, "&lt;").replace(/>/g, "&gt;") .replace(/"/g, "&quot;").replace(/'/g, "&#039;"); } function formatDate(date) { let d = new Date(date); let y = d.getFullYear().toString(); let m = (d.getMonth() + 1).toString(); if (m.length === 1) { m = '0' + m; } let dy = d.getDate().toString(); if (dy.length === 1) { dy = '0' + dy; } let h = d.getHours().toString(); if (h.length === 1) { h = '0' + h; } let mt = d.getMinutes().toString(); if (mt.length === 1) { mt = '0' + mt; } let s = d.getSeconds().toString(); if (s.length === 1) { s = '0' + s; } let S = d.getMilliseconds().toString(); if (S.length === 1) { S = '00' + S; } else if (S.length === 2) { S = '0' + S; } return y + "-" + m + "-" + dy + " " + h + ":" + mt + ":" + s + " " + S; } </script> </body> </html>
