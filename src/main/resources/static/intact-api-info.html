<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <title>接口文档</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgo=">
    <link rel="stylesheet" href="//cdn.bootcss.com/twitter-bootstrap/3.4.1/css/bootstrap.min.css">
    <style type="text/css">
        html {
            position: relative;
            min-height: 100%;
        }
        body {
            font-size: 16px;
        }
        header {
            position: sticky;
            top: 0;
            height: 50px;
            width: 100%;
            z-index: 999;
            transition: all .3s ease-in-out;
            background-color: transparent;
            border-bottom: 1px solid transparent;
            display: flex;
        }
        header.scrolled {
            background-color: #fff;
            border-bottom: 1px solid #f7f8f8;
            box-shadow: 0 0 10px -2px #333;
        }
        pre {
            font-size: 14px;
            overflow: auto;
            margin: 0 0 14px;
            padding: 7px 14px;
        }
        pre .line-number {
            color: #2B91AF;
            display: block;
            float: left;
            margin: 0 14px 0 -14px;
            border-right: 1px solid;
            text-align: right;
            padding: 0 7px 0 14px;
        }
        pre .comment {
            color: #998;
            font-style: italic;
        }
        table thead tr th {
            white-space: nowrap;
        }
        .header {
            display: flex;
        }
        .header-content {
            display: flex;
            align-items: center;
            flex-grow: 1;
            font-size: 26px;
            color: #6495ed;
            overflow: hidden;
            white-space: nowrap;
        }
        .header-text {
            display: flex;
            align-items: center;
            flex-grow: 0;
            white-space: nowrap;
            padding: 0 5px 0 20px;
        }
        .header-select {
            display: flex;
            align-items: center;
            flex-grow: 0;
        }
        .project-choose {
            min-width: 200px;
        }
        .footer {
            position: absolute;
            height: 133px;
            width: 100%;
            background: #f5f5f5;
            padding: 10px;
        }
        .footer > p {
            margin: 5px 0;
            text-align: center;
        }

        .panel {
            overflow: auto;
        }
        .module, .module-last {}
        .module-name {
            border-bottom: 5px solid #eee;
            margin-bottom: -5px;
        }
        .module-api {
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        .module-last > .module-api:last-child {
            border-bottom: none;
        }
        .module-api-index {}
        .module-api-info {}
        .module-api-info-basic {}
        .module-api-info-desc {}
        .module-api-info-param {}
        .module-api-info-return {}
        .bottom-table {
            margin-bottom: 10px;
        }
        .text-left {
            vertical-align: middle !important;
        }
        .response-example {
            color: #337ab7;
            text-decoration: none;
            background-color: transparent;
            cursor: pointer;
        }
        .response-example:focus, .response-example:hover {
            color: #23527c;
            text-decoration: underline;
        }
        .modal-dialog {
            width: 75%;
        }
        .bold {
            font-weight: bold !important;
        }
        .wrap {
            white-space: pre-wrap;
        }
        .red {
            color: red !important;
        }

        .bs-docs-sidebar {
            width: inherit;
            position: fixed;
            margin: 15px 0;
        }
        .bs-docs-sidebar > .nav {
            overflow-y: auto;
            max-height: calc(100vh - 50px - 15px - 15px); /* 100vh - header - top - bottom */
        }
        .bs-docs-sidebar .nav > li > a {
            display: block;
            padding: 4px 0 4px 20px;
            font-size: 14px;
            font-weight: 500;
            color: #999;
        }
        .bs-docs-sidebar .nav > li > a:hover,
        .bs-docs-sidebar .nav > li > a:focus {
            padding-left: 19px;
            color: #A1283B;
            text-decoration: none;
            background-color: transparent;
            border-left: 1px solid #A1283B;
        }
        .bs-docs-sidebar .nav > .active > a,
        .bs-docs-sidebar .nav > .active:hover > a,
        .bs-docs-sidebar .nav > .active:focus > a {
            padding-left: 18px;
            font-weight: bold;
            color: #A1283B;
            background-color: transparent;
            border-left: 2px solid #A1283B;
        }
        .bs-docs-sidebar .nav .nav {
            display: none;
            padding-bottom: 10px;
        }
        .bs-docs-sidebar .nav .nav > li > a {
            padding-top: 1px;
            padding-bottom: 1px;
            padding-left: 30px;
            font-size: 12px;
            font-weight: normal;
        }
        .bs-docs-sidebar .nav .nav > li > a:hover,
        .bs-docs-sidebar .nav .nav > li > a:focus {
            padding-left: 29px;
        }
        .bs-docs-sidebar .nav .nav > .active > a,
        .bs-docs-sidebar .nav .nav > .active:hover > a,
        .bs-docs-sidebar .nav .nav > .active:focus > a {
            padding-left: 28px;
            font-weight: 500;
        }
        .bs-docs-sidebar .nav .nav .nav {
            padding-bottom: 10px;
        }
        .bs-docs-sidebar .nav .nav .nav > li > a {
            padding-top: 1px;
            padding-bottom: 1px;
            padding-left: 40px;
            font-size: 12px;
            font-weight: normal;
        }
        .bs-docs-sidebar .nav .nav .nav > li > a:hover,
        .bs-docs-sidebar .nav .nav .nav > li > a:focus {
            padding-left: 39px;
        }
        .bs-docs-sidebar .nav > .active > ul {
            display: block;
        }
        .bs-docs-sidebar .nav .nav .nav > .active > a,
        .bs-docs-sidebar .nav .nav .nav > .active:hover > a,
        .bs-docs-sidebar .nav .nav .nav > .active:focus > a {
            padding-left: 38px;
            font-weight: 500;
        }
        @media print {
            pre .line-number, .print-nil {
                display: none;
            }
            pre, .text-left, .panel {
                overflow: unset;
            }
            pre, .text-left {
                white-space: pre-wrap;
            }
        }
        @media (max-width: 992px), print {
            .col-md-9 {
                width: 100%;
            }
            .col-md-3 {
                display: none;
            }
        }
        @media (max-width: 992px) {
            .modal-dialog {
                width: 95%;
            }
        }
        @media (max-width: 768px) {
            .container {
                width: 100%;
            }
        }
        @media (min-width: 993px) and (max-width: 1200px) {
            .bs-docs-sidebar {
                padding-left: 10px;
                width: calc(25% - 10px - 3px);
            }
        }
        @media (min-width: 1201px) {
            .bs-docs-sidebar {
                padding-left: 20px;
                width: calc(25% - 20px - 3px);
            }
        }
    </style>
</head>
<body>
<main class="container">
    <div class="row">
        <div id="url-info" class="col-md-9"></div>
        <script id="url-render" type="text/x-dot-template">
            {{~ it.moduleList  :module:index}}
            <div class="{{= index + 1 === it.moduleList.length ? 'module-last' : 'module'}}">
                <h2 id="{{= module.name}}" class="module-name"><span>{{= index + 1}}</span> {{= module.info || ''}}</h2>
                {{~ module.urlList  :url:urlIndex}}
                <div class="module-api">
                    <h3 id="{{= module.name}}-{{= url.id}}" class="module-api-index">
                        <span>{{= index + 1}}.{{= urlIndex + 1}}</span> {{= url.title || ''}}
                    </h3>
                    <div class="module-api-info">
                        <p class="module-api-info-basic">接口地址 <code>{{= url.method || ''}} {{= url.url || ''}}</code></p>
                        {{
                        var moduleDesc = '';
                        if (url.develop && url.develop !== '') {
                            moduleDesc += '开发: ' + url.develop;
                        }
                        if (url.desc && url.desc !== '') {
                            if (moduleDesc !== '') { moduleDesc += '<br>'; }
                            moduleDesc += '说明: ' + url.desc;
                        }

                        var printNil = '';
                        if (url.exampleUrl && url.exampleUrl != '') {
                            var example = '<a target="_blank" href="' + url.exampleUrl + '">响应结果示例地址</a>';
                            if (moduleDesc !== '') {
                                moduleDesc += '<span class="print-nil"><br><br>' + example + '</span>';
                            } else {
                                printNil = ' print-nil';
                                moduleDesc += example;
                            }
                        }
                        }}
                        <pre class="module-api-info-desc{{= printNil}}">{{= moduleDesc}}</pre>

                        {{
                        var globalParamList = it.tokenList || [];
                        var urlParamList = url.paramList || [];
                        var paramList = (url.useGlobalParam === '1' || url.useGlobalParam === 1) ? globalParamList.concat(urlParamList) : urlParamList;

                        var hasDesc = false, hasExample = false, hasHeader = false;
                        for (var i = 0; i < paramList.length; i++) {
                            var paramDesc = paramList[i].desc;
                            if (paramDesc !== undefined && paramDesc !== null && paramDesc !== '') { hasDesc = true; }

                            var urlExample = paramList[i].example;
                            if (urlExample !== undefined && urlExample !== null && urlExample !== '') { hasExample = true; }

                            if (paramList[i].paramType === '1' || paramList[i].paramType === 1) { hasHeader = true; }
                        }
                        }}
                        {{? paramList && paramList.length > 0}}
                        <div class="module-api-info-param bottom-table panel panel-default">
                            <table class="table table-striped table-bordered table-hover table-condensed">
                                <thead>
                                <tr>
                                    <th class="text-left">参数名称</th>
                                    <th class="text-left">数据类型</th>
                                    <th class="text-left">必须</th>
                                    {{? hasDesc}}<th class="text-left">说明</th>{{?}}
                                    {{? hasExample}}<th class="text-left">示例</th>{{?}}
                                    {{? hasHeader}}<th class="text-left">参数类型</th>{{?}}
                                </tr>
                                </thead>
                                <tbody>
                                {{~ paramList  :param}}
                                <tr{{? param.hasMust === '1' || param.hasMust === 1}} class="bold"{{?}}{{? param.style && param.style !== ''}} style="{{= param.style}}"{{?}}>
                                    <td class="text-left">{{= param.name || ''}}</td>
                                    <td class="text-left">{{=
                                        param.showDataType !== undefined && param.showDataType !== null && param.showDataType !== ''
                                        ? param.showDataType
                                        : (param.dataType !== undefined && param.dataType !== null && param.dataType !== '' ? param.dataType : '')
                                    }}</td>
                                    <td class="text-left">{{= (param.hasMust === '1' || param.hasMust === 1) ? 'Yes' : 'No'}}</td>
                                    {{? hasDesc}}<td class="text-left wrap">{{= param.desc || ''}}</td>{{?}}
                                    {{? hasExample}}<td class="text-left wrap">{{= param.example || ''}}</td>{{?}}
                                    {{? hasHeader}}<td class="text-left">{{= (param.paramType === '1' || param.paramType === 1) ? 'Header' : 'Query'}}</td>{{?}}
                                </tr>
                                {{~}}
                                </tbody>
                            </table>
                        </div>
                        {{?}}

                        <div class="module-api-info-return">
                            <p>响应示例及说明如下</p>
                            <pre class="src src-json">{{= url.commentJson || ''}}</pre>

                            {{? url.returnList && url.returnList.length > 0}}
                            <div class="bottom-table panel panel-default">
                                <table class="table table-striped table-bordered table-hover table-condensed">
                                    <thead>
                                    <tr>
                                        <th class="text-left">名称</th>
                                        <th class="text-left">类型</th>
                                        <th class="text-left">说明</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {{~ url.returnList  :rtn}}
                                    <tr>
                                        <td class="text-left">{{= rtn.name || ''}}</td>
                                        <td class="text-left">{{= rtn.type || ''}}</td>
                                        <td class="text-left wrap">{{= (rtn.desc || '').replace(/(!!!RECURSIVE OBJECT!!!)/, '<span class="bold red">!!!递归实体!!!</span>')}}</td>
                                    </tr>
                                    {{~}}
                                    </tbody>
                                </table>
                            </div>
                            {{?}}

                            {{
                            var hasSelfResponse = false;
                            var responseList;
                            if (url.responseList && url.responseList.length > 0) {
                                hasSelfResponse = true;
                                responseList = url.responseList;
                            } else if (it.responseList && it.responseList.length > 0) {
                                responseList = it.responseList;
                            } else { responseList = []; }

                            var hasAction = false;
                            for (var i = 0; i < responseList.length; i++) {
                                var comment = responseList[i].comment;
                                if (comment !== undefined && comment !== null && comment !== '') { hasAction = true; }
                            }
                            }}
                            {{? responseList.length > 0}}
                            <div class="bottom-table panel panel-default">
                                <table class="table table-striped table-bordered table-hover table-condensed">
                                    <thead>
                                    <tr>
                                        <th class="text-left">响应码</th>
                                        <th class="text-left">说明</th>
                                        {{? hasAction}}<th class="text-left print-nil">操作</th>{{?}}
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {{~ responseList  :response}}
                                    <tr>
                                        <td class="text-left">{{= response.code || ''}}</td>
                                        <td class="text-left">{{= response.msg || ''}}</td>
                                        {{
                                        var comment = response.comment;
                                        var targetId = hasSelfResponse ? (module.name + '-' + url.id + '-' + response.code) : ('global-' + response.code);
                                        }}
                                        {{? comment !== undefined && comment !== null && comment !== ''}}
                                        <td class="text-left print-nil">
                                            <span class="response-example" title="点击查看响应 {{= response.code + ': ' + response.msg}} 时的示例"
                                                  data-toggle="modal" data-target="#{{= targetId}}">查看示例</span>
                                        </td>
                                        {{?? hasAction}}
                                        <td class="text-left print-nil"></td>
                                        {{?}}
                                    </tr>
                                    {{~}}
                                    </tbody>
                                </table>
                            </div>

                            {{? hasSelfResponse}}
                            {{~ responseList  :response}}
                            {{ var comment = response.comment; }}
                            {{? comment !== undefined && comment !== null && comment !== ''}}
                            <div id="{{= module.name}}-{{= url.id}}-{{= response.code}}" class="modal fade" tabindex="-1"
                                 aria-hidden="true" data-backdrop="static" data-keyboard="false">
                                <div class="modal-dialog modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal">
                                            &times;
                                        </button>
                                        <h4 class="modal-title">
                                            模块「{{= module.info || ''}}」接口「{{= url.title || ''}}」响应「{{= response.code + ': ' + response.msg}}」的示例
                                        </h4>
                                    </div>
                                    <div class="modal-body">
                                        <pre class="src src-json">{{= response.comment || ''}}</pre>

                                        {{? response.returnList && response.returnList.length > 0}}
                                        <div class="bottom-table panel panel-default">
                                            <table class="table table-striped table-bordered table-hover table-condensed">
                                                <thead>
                                                <tr>
                                                    <th class="text-left">名称</th>
                                                    <th class="text-left">类型</th>
                                                    <th class="text-left">说明</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                {{~ response.returnList  :rtn}}
                                                <tr>
                                                    <td class="text-left">{{= rtn.name || ''}}</td>
                                                    <td class="text-left">{{= rtn.type || ''}}</td>
                                                    <td class="text-left wrap">{{= (rtn.desc || '').replace(/(!!!RECURSIVE OBJECT!!!)/, '<span class="bold red">!!!递归实体!!!</span>')}}</td>
                                                </tr>
                                                {{~}}
                                                </tbody>
                                            </table>
                                        </div>
                                        {{?}}
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                    </div>
                                </div>
                            </div>
                            {{?}}
                            {{~}}
                            {{?}}
                            {{?}}
                        </div>
                    </div>
                </div>
                {{~}}
            </div>
            {{~}}

            {{~ it.responseList  :response}}
            {{ var comment = response.comment; }}
            {{? comment !== undefined && comment !== null && comment !== ''}}
            <div id="global-{{= response.code}}" class="modal fade" tabindex="-1"
                 aria-hidden="true" data-backdrop="static" data-keyboard="false">
                <div class="modal-dialog modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">
                            &times;
                        </button>
                        <h4 class="modal-title">
                            全局响应「{{= response.code + ': ' + response.msg}}」的示例
                        </h4>
                    </div>
                    <div class="modal-body">
                        <pre class="src src-json">{{= response.comment || ''}}</pre>

                        {{? response.returnList && response.returnList.length > 0}}
                        <div class="bottom-table panel panel-default">
                            <table class="table table-striped table-bordered table-hover table-condensed">
                                <thead>
                                <tr>
                                    <th class="text-left">名称</th>
                                    <th class="text-left">类型</th>
                                    <th class="text-left">说明</th>
                                </tr>
                                </thead>
                                <tbody>
                                {{~ response.returnList  :rtn}}
                                <tr>
                                    <td class="text-left">{{= rtn.name || ''}}</td>
                                    <td class="text-left">{{= rtn.type || ''}}</td>
                                    <td class="text-left wrap">{{= (rtn.desc || '').replace(/(!!!RECURSIVE OBJECT!!!)/, '<span class="bold red">!!!递归实体!!!</span>')}}</td>
                                </tr>
                                {{~}}
                                </tbody>
                            </table>
                        </div>
                        {{?}}
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    </div>
                </div>
            </div>
            {{?}}
            {{~}}
        </script>
        <div class="col-md-3">
            <div class="bs-docs-sidebar">
                <ul id="url-nav-info" class="nav"></ul>
                <script id="url-nav-render" type="text/x-dot-template">
                    {{~ it.moduleList  :module:index}}
                    <li>
                        <a href="#{{= module.name}}">{{= index + 1}} {{= module.info || ''}}</a>
                        <ul class="nav">
                            {{~ module.urlList  :url:urlIndex}}
                            <li>
                                <a href="#{{= module.name}}-{{= url.id}}">{{= index + 1}}.{{= urlIndex + 1}} {{= url.title || ''}}</a>
                            </li>
                            {{~}}
                        </ul>
                    </li>
                    {{~}}
                </script>
            </div>
        </div>
    </div>
</main>
<footer></footer>
<script id="copyright" type="text/x-dot-template">
    <div class="footer">
        <p class="version">版本: <span>{{= it.version || ''}}</span></p>
        <p class="statistics">共 {{= it.groupCount || ''}} 个模块, {{= it.apiCount || ''}} 个接口</p>
        <p class="team">{{= it.team || ''}}</p>
        <p class="copyright">&copy; {{= new Date().getFullYear()}} {{= it.copyright || ''}}</p>
    </div>
</script>

<!--[if lt IE 9]>
<script src="//cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<script src="//cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<script src="//cdn.bootcss.com/twitter-bootstrap/3.4.1/js/bootstrap.min.js"></script>
<script src="//cdn.bootcss.com/dot/1.1.2/doT.min.js"></script>
<script type="text/javascript">
function isBlank(str) {
    return str === undefined || str === null || str === 'undefined' || str === 'null' || str === '';
}
function isNotBlank(str) {
    return !isBlank(str);
}
function addLine(html) {
    if (isBlank(html)) {
        return '';
    }

    var lineNum = html.split(/\n/).length;
    var lineHtml = '<span class="line-number">';
    var i;
    for (i = 0; i < lineNum; i++) {
        lineHtml += (i + 1) + '\n';
    }
    lineHtml = lineHtml.trim();
    lineHtml += '</span>';
    return lineHtml + html;
}
function escapeHtml(html) {
    return isBlank(html) ? null : html.replace(/</g, '&lt;').replace(/>/g, '&gt;');
}

$.get('/api/project').done(function(data) {
    if (isNotBlank(data)) {
        var projectInfo = ((typeof data === 'string') ? JSON.parse(data) : data);
        if (isNotBlank(projectInfo)) {
            var projectHtml = '<header class="print-nil">';
            projectHtml += '<div class="header container">';
            projectHtml += '<div class="header-content"></div>';
            projectHtml += '<div class="header-text">选择项目:</div>';
            projectHtml += '<div class="header-select">';
            projectHtml += '<select class="project-choose form-control" name="p">';
            projectHtml += '<option value="">当前</option>';

            var project = location.search;
            var param = 'p=', append = '&';
            if (project.includes(param)) {
                project = project.substring(project.indexOf(param) + param.length);
                if (project.includes(append)) {
                    project = project.substring(0, project.indexOf(append));
                }
            }
            for (var index in projectInfo) {
                var arr = projectInfo[index];
                if (arr.length === 3) {
                    projectHtml += '<option value="' + arr[0] + '" data-url="' + arr[2] + '"';
                    if (project.toLowerCase() === arr[0].toLowerCase() || project === arr[1]) {
                        projectHtml += ' selected';
                    }
                    projectHtml += '>' + arr[1] + '</option>';
                }
            }

            projectHtml += '</select>';
            projectHtml += '</div>';
            projectHtml += '</div>';
            projectHtml += '</header>';
            $("body").prepend(projectHtml);
        }
    }
    loadData();
}).fail(function () {
    loadData();
});

function getProjectDomain() {
    var projectDomain = $('.project-choose').find('option:selected').data('url');
    return isBlank(projectDomain) ? (location.protocol + '//' + location.host) : projectDomain;
}

var copyrightTemplate = doT.template($('#copyright').html());
var urlRenderTemplate = doT.template($('#url-render').html());
var navRenderTemplate = doT.template($('#url-nav-render').html());

function loadData() {
    var projectDomain = getProjectDomain();

    var $title = $('title');
    var $headerContent = $('.header-content');
    var $footer = $('footer');
    var $urlInfo = $('#url-info');
    var $urlNavInfo = $('#url-nav-info');

    var requestData = {
        type: 'GET',
        url: projectDomain + '/api/info',
    };
    var locationDomain = location.protocol + '//' + location.host;
    if (isNotBlank(projectDomain) && locationDomain !== projectDomain && !projectDomain.startsWith(locationDomain + '/')) {
        requestData.crossDomain = true;
    }

    $title.html('');
    $headerContent.html('');
    $footer.html('');
    $urlInfo.html('');
    $urlNavInfo.html('');

    $.ajax(requestData).done(function (data) {
        if (isNotBlank(data)) {
            var documentInfo = ((typeof data === 'string') ? JSON.parse(data) : data);

            {
                var copyright = documentInfo.copyright;
                if (isBlank(copyright)) {
                    return;
                }

                var title = copyright.title;
                if (isNotBlank(title)) {
                    $title.html(title);
                    $headerContent.html(title);
                }
                $footer.html(copyrightTemplate(copyright));
            }

            {
                var doc = documentInfo.document;
                if (isBlank(doc)) {
                    return;
                }
                $urlInfo.html(urlRenderTemplate(doc));
                $urlNavInfo.html(navRenderTemplate(doc));

                $('pre[class="src src-json"]').each(function () {
                    var $html = escapeHtml($(this).html());
                    var html;
                    if (isNotBlank($html)) {
                        html = $html.replace(/(.*?)(\/\*.*?\*\/)/g, '$1<span class="comment">$2</span>');

                        var recursiveRegex = /(!!!RECURSIVE OBJECT!!!)/;
                        if (recursiveRegex.test($html)) {
                            html = html.replace(new RegExp(recursiveRegex, 'g'), '<span class="bold red">!!!递归实体!!!</span>');
                        }
                    } else {
                        html = '<span class="red">响应为空 或 无法解析返回类型</span>';
                    }
                    $(this).html(addLine(html));
                });

                var hash = location.hash;
                if (isNotBlank(hash)) {
                    var $anchor = $(hash);
                    if ($anchor.length > 0) {
                        var $li = $('a[href="' + hash + '"]').parents('li');
                        $li.addClass('active');
                        $li.parents('li').addClass('active');
                        $('html,body').animate({scrollTop: $anchor.offset().top}, 0);
                    }
                }
            }
        } else {
            $urlInfo.html('<span class="red">无接口信息</span>');
        }
    }).fail(function () {
        $urlInfo.html('<span class="red">接口请求错误</span>');
    });
}

$(function() {
    $('.project-choose').on("change", function() {
        var projectUrl = $(this).find('option:selected').data('url');
        var hash = isBlank(projectUrl) ? '' : ('?p=' + $(this).val());
        history.replaceState({api: $(this).val()}, '', location.pathname + hash);
        loadData();
    });

    $(document.body).scrollspy({target: '.bs-docs-sidebar'});

    var headerHeight = isBlank($('header').html()) ? 0 : 50;
    var topBottomHeight = 30;
    var heightProperty = 'max-height';

    var html = document.getElementsByTagName('html')[0];
    var footer = document.getElementsByTagName('footer')[0];

    var $win = $(window);
    var $nav = $('.col-md-3');
    var $bar = $('.bs-docs-sidebar > .nav');

    $win.scroll(function() {
        var scrolled = 'scrolled';
        var $header = $('header');
        if ($win.scrollTop() > 0) {
            if (!$header.hasClass(scrolled)) {
                $header.addClass(scrolled);
            }
        } else {
            $header.removeClass(scrolled);
        }

        if ($nav.css('display') !== 'none') {
            { /* 如果在页脚切换项目, 这时的 footerTop 还会是之前的, 这会导致 nav 无法显示, 再滚动一下就好了, 切换项目用 location.reload() 可以解决 */
                var footerTop = footer.offsetTop;
                var scrollTop = $win.scrollTop();
                var pageHeight = scrollTop + $win.height();
                if (footerTop >= scrollTop && footerTop < pageHeight) {
                    var footViewHeight = pageHeight - footerTop;
                    $bar.css(heightProperty, 'calc(100vh - ' + (headerHeight + topBottomHeight + footViewHeight) + 'px)');
                } else {
                    var htmlViewHeight = (html.clientHeight - headerHeight - topBottomHeight) + 'px';
                    if ($bar.css(heightProperty) !== htmlViewHeight) {
                        $bar.css(heightProperty, 'calc(100vh - ' + (headerHeight + topBottomHeight) + 'px)');
                    }
                }
            }

            {
                var navHash = $nav.find('.active > a:last').attr('href');
                if (navHash !== location.hash) {
                    if (isBlank(navHash)) {
                        history.replaceState({api: 'index'}, '', location.pathname + location.search);
                    } else {
                        history.replaceState({api: navHash}, '', location.pathname + location.search + navHash);
                    }
                }
            }
        }
    });
});
</script>
</body>
</html>
